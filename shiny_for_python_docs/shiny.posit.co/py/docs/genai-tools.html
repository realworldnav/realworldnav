<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tool calling – Shiny for Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="genai-structured-data.html" rel="next">
<link href="genai-stream.html" rel="prev">
<link href="../favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-888ef42a095209a13a17dbfda2cb877d.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-06a6b8726800c70458725a52052b40c7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
  // Redirect URLs like https://shiny.posit.co/py to
  // https://shiny.posit.co/py/ (with trailing slash). This is needed for
  // relative paths to work correctly. Unfortunately, Netlify cannot have a
  // redirect that adds or removes a trailing slash.
  if (
    !window.location.pathname.endsWith(".html") &&
    !window.location.pathname.endsWith("/")
  ) {
    window.location.replace(window.location.href + "/");
  }
</script>

<!-- Google Tag Manager -->
<script>
  // prettier-ignore
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KHBDBW7');
</script>
<!-- End Google Tag Manager -->

<!-- Add rel="noopener noreferrer" to each target="_blank" -->
<script type="text/javascript">
  window.addEventListener("load", () =>
    [...document.querySelectorAll("a[target=_blank]")].forEach((lnk) =>
      lnk.setAttribute("rel", "noopener noreferrer")
    )
  );
</script>
<!-- End Add rel="noopener noreferrer" to each target="_blank" -->

<script type="text/javascript">
  (function () {
    function addShinyliveEditLinks() {
      const codeWithLink = document.querySelectorAll(
        ".sourceCode[data-shinylive]"
      );
      codeWithLink.forEach((el) => {
        el.classList.add("code-with-shinylive-link");
        const url = el.dataset.shinylive;

        // <a class="edit-shinylive-button btn btn-link" href="https://shiny.posit.co/py/docs/&lt;%=&#32;app.shinylive&#32;%&gt;" data-bs-toggle="tooltip" data-bs-title="Edit in Shinylive" data-bs-placement="bottom">
        //  <i class="bi bi-lightning-fill"></i> <span class="visually-hidden">Edit in Shinylive</span>
        // </a>

        const link = document.createElement("a");
        link.classList.add("edit-shinylive-button", "btn", "btn-link");
        link.href = url;
        link.dataset.bsToggle = "tooltip";
        link.dataset.bsTitle = "Edit in Shinylive";
        link.dataset.bsPlacement = "bottom";

        const icon = document.createElement("i");
        icon.classList.add("bi", "bi-lightning-fill");
        link.appendChild(icon);

        const span = document.createElement("span");
        span.classList.add("visually-hidden");
        span.innerText = "Edit in Shinylive";
        link.appendChild(span);

        const btnCopy = el.querySelector(".code-copy-button");
        if (btnCopy) {
          btnCopy.parentElement.appendChild(link);
        } else {
          if (el.matches("pre")) {
            el.appendChild(link);
          } else {
            el.querySelector("pre").appendChild(link);
          }
        }

        if (window.bootstrap?.Tooltip) {
          new bootstrap.Tooltip(link);
        }
        el.removeAttribute("data-shinylive");
      });
    }

    function addWhatsShinyExpressTooltip() {
      const tooltipContents = `<p><strong>Shiny Express</strong> is a new, streamlined way to write a Shiny app.</p>
    <p><strong>Shiny Core</strong> refers to the original, functional Shiny syntax, which is still a great way to write Shiny apps.</p>
    <p class="fw-600" style="font-size:0.85em;"><a href="https://shiny.posit.co/blog/posts/shiny-express/">Read more <i class="bi bi-chevron-right align-text-top"></i></a></p>`;

      const tooltipDisplay = `<i class="bi bi-question-circle-fill d-inline d-sm-none"></i><span class="d-none d-sm-inline">What's this?</span>`;

      document
        .querySelectorAll(".panel-tabset.shiny-mode-tabset")
        .forEach(function (tabset) {
          const trigger = document.createElement("div");
          trigger.classList.add("what-shiny-express", "text-white");
          trigger.tabIndex = 0;
          trigger.innerHTML = tooltipDisplay;
          tabset.appendChild(trigger);

          if (!window.bootstrap?.Popover) {
            return;
          }

          new window.bootstrap.Popover(trigger, {
            html: true,
            title: "Express vs Core",
            content: tooltipContents,
            placement: "auto",
            trigger: "focus",
            container: tabset,
          });
        });
    }

    function handlePanelVariants() {
      document.querySelectorAll(".panel-pills > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-pills");
      });
      document.querySelectorAll(".panel-underline > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-underline");
      });
      document.querySelectorAll(".shiny-mode-tabset > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-underline");
      });
    }

    function onLoad() {
      addShinyliveEditLinks();
      addWhatsShinyExpressTooltip();
      handlePanelVariants();
    }

    document.readyState === "loading"
      ? document.addEventListener("DOMContentLoaded", onLoad)
      : onLoad();
  })();
</script>

<!-- <div
  class="alert alert-primary text-center mb-0 border-0"
  style="padding: 0.6rem"
  role="alert"
>
  <p class="d-md-inline my-0 me-md-4 p-90">
    <strong>🎉 Introducing Shiny Express</strong>
  </p>
  <p class="d-md-inline my-0 p-90 me-md-4">
    A simpler way to write and learn Shiny.
  </p>
  <p class="d-md-inline my-0 p-90 me-md-4">
    <a
      href="https://shiny.posit.co/blog/posts/shiny-express/"
      target="_blank"
      style="color: #00314e"
      >Learn more</a
    >.
  </p>
</div> -->


<meta property="og:title" content="Tool calling – Shiny for Python">
<meta property="og:description" content="Build interactive web applications easily with the power of Python’s data and scientific stack.">
<meta property="og:image" content="https://shiny.posit.co/py/images/shiny-for-python.jpg">
<meta property="og:site_name" content="Shiny for Python">
<meta property="og:locale" content="es_ES">
<meta name="twitter:title" content="Shiny for Python">
<meta name="twitter:description" content="Build interactive web applications easily with the power of Python’s data and scientific stack.">
<meta name="twitter:image" content="https://shiny.posit.co/py/images/shiny-for-python.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../shiny-for-python.svg" alt="The logo for Shiny for Python" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Shiny for Python</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../get-started/index.html"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="overview.html" aria-current="page"> 
<span class="menu-text">Concepts</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="genai-tools.html#" id="nav-menu-components" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Components</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-components">    
        <li>
    <a class="dropdown-item" href="../components/index.html"><i class="bi bi-sliders" role="img">
</i> 
 <span class="dropdown-text">Components</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../layouts/index.html"><i class="bi bi-layout-text-window-reverse" role="img">
</i> 
 <span class="dropdown-text">Layouts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../templates/index.html"><i class="bi bi-code-square" role="img">
</i> 
 <span class="dropdown-text">Templates</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../gallery/index.html"> 
<span class="menu-text">Gallery</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://shinylive.io/py/examples/" target="_blank"> 
<span class="menu-text">Playground</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="genai-tools.html#" id="nav-menu-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reference">    
        <li>
    <a class="dropdown-item" href="../api/express/index.html">
 <span class="dropdown-text">Shiny Express</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api/core/index.html">
 <span class="dropdown-text">Shiny Core</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api/testing/index.html">
 <span class="dropdown-text">Testing</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://discord.gg/yMGCamUMnS" title="" class="quarto-navigation-tool px-1" aria-label="Shiny Discord"><i class="bi bi-discord"></i></a>
    <a href="https://github.com/posit-dev/py-shiny/" title="" class="quarto-navigation-tool px-1" aria-label="Shiny for Python Github"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="genai-inspiration.html"><span class="emoji-icon">🤖</span> <strong>Generative AI</strong></a></li><li class="breadcrumb-item"><a href="genai-tools.html">Tool calling</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📌</span> <strong>Essentials</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="user-interfaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">User interfaces</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🤖</span> <strong>Generative AI</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-inspiration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Get inspired</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-chatbots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chatbots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-stream.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Streaming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-tools.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Tool calling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-structured-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structured data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-rag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAG</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🎨</span> <strong>User interfaces</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="jupyter-widgets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jupyter Widgets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-dynamic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic UI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">UI as HTML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-customize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Customizing UI</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">⚡</span> <strong>Reactivity</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-mutable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mutable objects</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📝</span> <strong>Syntax modes</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-vs-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Express vs.&nbsp;Core</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-or-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Choosing a syntax</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-in-depth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Express in depth</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-to-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transition to Core</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📦</span> <strong>Modules</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="modules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shiny Modules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="module-communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Module Communication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🧪</span> <strong>Testing</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="unit-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="end-to-end-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End-to-End Testing Your App</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🏗️</span> <strong>Extending</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="custom-component-one-off.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom JavaScript component</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="custom-components-pkg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom components package</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📊</span> <strong>Comparisons</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="comp-streamlit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Streamlit</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="comp-r-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shiny for R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🧩</span> <strong>Miscellaneous</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="nonblocking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Non-blocking operations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="routing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Routing</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="genai-tools.html#why-tool-calling" id="toc-why-tool-calling" class="nav-link active" data-scroll-target="#why-tool-calling">Why tool calling?</a></li>
  <li><a href="genai-tools.html#get-started" id="toc-get-started" class="nav-link" data-scroll-target="#get-started">Get started</a>
  <ul class="collapse">
  <li><a href="genai-tools.html#fundamentals" id="toc-fundamentals" class="nav-link" data-scroll-target="#fundamentals">Fundamentals</a></li>
  <li><a href="genai-tools.html#basic-chatbot" id="toc-basic-chatbot" class="nav-link" data-scroll-target="#basic-chatbot">Basic chatbot</a></li>
  </ul></li>
  <li><a href="genai-tools.html#reactivity" id="toc-reactivity" class="nav-link" data-scroll-target="#reactivity">Reactivity</a>
  <ul class="collapse">
  <li><a href="genai-tools.html#updating-inputs" id="toc-updating-inputs" class="nav-link" data-scroll-target="#updating-inputs">Updating inputs</a></li>
  <li><a href="genai-tools.html#managing-state" id="toc-managing-state" class="nav-link" data-scroll-target="#managing-state">Managing state</a></li>
  </ul></li>
  <li><a href="genai-tools.html#custom-display" id="toc-custom-display" class="nav-link" data-scroll-target="#custom-display">Custom tool display</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/posit-dev/py-shiny-site/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/posit-dev/py-shiny-site/edit/main/docs/genai-tools.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KHBDBW7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="genai-inspiration.html"><span class="emoji-icon">🤖</span> <strong>Generative AI</strong></a></li><li class="breadcrumb-item"><a href="genai-tools.html">Tool calling</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Tool calling</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="why-tool-calling" class="level2">
<h2 class="anchored" data-anchor-id="why-tool-calling">Why tool calling?</h2>
<p>Large language models (LLMs) are inherently good at drawing from their vast knowledge base to generate helpful responses based on a user prompt. However, they are not inherently good at or capable of everything. Some of their limitations can be addressed by equipping the LLM with the ability to call tools (i.e., functions). For example, LLMs are not inherently good at:</p>
<ol type="1">
<li>Making precise, reliable, and reproducible calculations based on data.</li>
<li>Accessing up-to-date, private, or otherwise “most relevant” information.</li>
<li>Generally accomplishing programmatic tasks at the request of the user.</li>
</ol>
<p>For a motivating example, consider <a href="../templates/sidebot/index.html">the sidebot template</a>. It allows end users to ask questions about a dataset using natural language, and see multiple views of the data update in real-time. It works by equipping the LLM with the context and tools to control the dashboard through SQL. And, since LLMs are inherently good at translating natural language to SQL, the result is a suprisingly effective (and verfiable!) way to explore data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-sidebot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Screenshot of the sidebot template, which allows users to explore data using natural language."><img src="../images/genai-sidebot.png" class="rounded shadow mt-3 img-fluid figure-img" alt="Screenshot of the sidebot template, which allows users to explore data using natural language."></a></p>
<figcaption>Screenshot of the <a href="../templates/sidebot/index.html">sidebot template</a>, which allows users to explore data using natural language.</figcaption>
</figure>
</div>
<p>This article discusses the mechanics behind what makes an app like sidebot work. It covers:</p>
<ul>
<li><a href="genai-tools.html#get-started">Get started</a> with tool calls, including <a href="genai-tools.html#basic-chatbot">displaying</a> status/results in Shiny.</li>
<li>Combine tools with <a href="genai-tools.html#reactivity">reactivity</a>, enabling the LLM to “use” the app.</li>
<li><a href="genai-tools.html#custom-display">Customize</a> the display of tool calls.</li>
</ul>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beyond chatbots
</div>
</div>
<div class="callout-body-container callout-body">
<p>Although this article focuses on using tool calling in a chatbot, the same ideas also apply to <a href="genai-stream.html">streaming markdown</a></p>
</div>
</div>
</section>
<section id="get-started" class="level2">
<h2 class="anchored" data-anchor-id="get-started">Get started</h2>
<section id="fundamentals" class="level3">
<h3 class="anchored" data-anchor-id="fundamentals">Fundamentals</h3>
<p>LLMs are trained on data up until a certain cutoff date, and they don’t natively have access to the internet. This means that they can’t answer questions about current events, weather, etc. Most LLMs nowadays are at least aware of this limitation:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="genai-tools.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatAnthropic</span>
<span id="cb1-2"><a href="genai-tools.html#cb1-2" aria-hidden="true" tabindex="-1"></a>chat_client <span class="op">=</span> ChatAnthropic()</span>
<span id="cb1-3"><a href="genai-tools.html#cb1-3" aria-hidden="true" tabindex="-1"></a>chat_client.chat(<span class="st">"What's the current temperature in Duluth, MN?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>I don’t have the ability to check the current temperature in Duluth, MN in real-time.</p>
</blockquote>
<p>However, we can equip the LLM with a function to query current weather from a web API. Since LLMs are good at finding structure from unstructured input, we can have a tool that accepts lat/long as input, and the LLM is smart enough to infer a lat/long from a city name (or ask the user for lat/long).</p>
<p>Note also that the function <strong>includes type hints and a docstring</strong>. This is important because it helps the LLM understand what the function does and how to use it.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="genai-tools.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb2-2"><a href="genai-tools.html#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="genai-tools.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_current_weather(latitude: <span class="bu">float</span>, longitude: <span class="bu">float</span>):</span>
<span id="cb2-4"><a href="genai-tools.html#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Get the current current weather given a latitude and longitude."""</span></span>
<span id="cb2-5"><a href="genai-tools.html#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="genai-tools.html#cb2-6" aria-hidden="true" tabindex="-1"></a>    lat_lng <span class="op">=</span> <span class="ss">f"latitude=</span><span class="sc">{</span>latitude<span class="sc">}</span><span class="ss">&amp;longitude=</span><span class="sc">{</span>longitude<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb2-7"><a href="genai-tools.html#cb2-7" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="ss">f"https://api.open-meteo.com/v1/forecast?</span><span class="sc">{</span>lat_lng<span class="sc">}</span><span class="ss">&amp;current=temperature_2m,wind_speed_10m&amp;hourly=temperature_2m,relative_humidity_2m,wind_speed_10m"</span></span>
<span id="cb2-8"><a href="genai-tools.html#cb2-8" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb2-9"><a href="genai-tools.html#cb2-9" aria-hidden="true" tabindex="-1"></a>    json <span class="op">=</span> response.json()</span>
<span id="cb2-10"><a href="genai-tools.html#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> json[<span class="st">"current"</span>]</span>
<span id="cb2-11"><a href="genai-tools.html#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="genai-tools.html#cb2-12" aria-hidden="true" tabindex="-1"></a>chat_client.register_tool(get_current_weather)</span>
<span id="cb2-13"><a href="genai-tools.html#cb2-13" aria-hidden="true" tabindex="-1"></a>chat_client.chat(<span class="st">"What's the current temperature in Duluth, MN?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>The current temperature in Duluth, Minnesota is 0.9°C (which is approximately 33.6°F). There are also strong winds at 32.7 km/h (about 20.3 mph).</p>
</blockquote>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Verify the tool call
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <code>.chat()</code>, you can set <code>echo="all"</code> to see all the tool call information in your console. In the <a href="genai-tools.html#tool-displays">Tool displays</a>, we’ll see how to display this information in the Shiny UI.</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learn more
</div>
</div>
<div class="callout-body-container callout-body">
<p>See the <a href="https://posit-dev.github.io/chatlas/tool-calling.html">chatlas docs</a> to learn more about tool calling fundamentals.</p>
</div>
</div>
</section>
<section id="basic-chatbot" class="level3">
<h3 class="anchored" data-anchor-id="basic-chatbot">Basic chatbot</h3>
<p>To embed our <code>chat_client</code> in a Shiny <a href="genai-chatbots.html">chatbot</a>, let’s put it in a <code>client.py</code> module and use it for response generation. To display the tool call results, just set <code>content="all"</code> in the <code>.stream_async()</code> method. This way, <code>chatlas</code> will include tool call content objects in the stream, and since those content objects know how to display themselves in Shiny, we get a generic display of the tool request, response, and any errors that occurred.</p>
<details>
<summary>
client.py
</summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="genai-tools.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-2"><a href="genai-tools.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatAnthropic</span>
<span id="cb3-3"><a href="genai-tools.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="genai-tools.html#cb3-4" aria-hidden="true" tabindex="-1"></a>chat_client <span class="op">=</span> ChatAnthropic()</span>
<span id="cb3-5"><a href="genai-tools.html#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="genai-tools.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_current_weather(latitude: <span class="bu">float</span>, longitude: <span class="bu">float</span>):</span>
<span id="cb3-7"><a href="genai-tools.html#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Get the current temperature given a latitude and longitude."""</span></span>
<span id="cb3-8"><a href="genai-tools.html#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="genai-tools.html#cb3-9" aria-hidden="true" tabindex="-1"></a>    lat_lng <span class="op">=</span> <span class="ss">f"latitude=</span><span class="sc">{</span>latitude<span class="sc">}</span><span class="ss">&amp;longitude=</span><span class="sc">{</span>longitude<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb3-10"><a href="genai-tools.html#cb3-10" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="ss">f"https://api.open-meteo.com/v1/forecast?</span><span class="sc">{</span>lat_lng<span class="sc">}</span><span class="ss">&amp;current=temperature_2m,wind_speed_10m&amp;hourly=temperature_2m,relative_humidity_2m,wind_speed_10m"</span></span>
<span id="cb3-11"><a href="genai-tools.html#cb3-11" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb3-12"><a href="genai-tools.html#cb3-12" aria-hidden="true" tabindex="-1"></a>    json <span class="op">=</span> response.json()</span>
<span id="cb3-13"><a href="genai-tools.html#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> json[<span class="st">"current"</span>]</span>
<span id="cb3-14"><a href="genai-tools.html#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="genai-tools.html#cb3-15" aria-hidden="true" tabindex="-1"></a>chat_client.register_tool(get_current_weather)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>
app.py
</summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="genai-tools.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> client <span class="im">import</span> chat_client</span>
<span id="cb4-2"><a href="genai-tools.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> ui</span>
<span id="cb4-3"><a href="genai-tools.html#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="genai-tools.html#cb4-4" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb4-5"><a href="genai-tools.html#cb4-5" aria-hidden="true" tabindex="-1"></a>chat.ui(messages<span class="op">=</span>[<span class="st">"Hello! How can I help you today?"</span>])</span>
<span id="cb4-6"><a href="genai-tools.html#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="genai-tools.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">@chat.on_user_submit</span></span>
<span id="cb4-8"><a href="genai-tools.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> _(user_input: <span class="bu">str</span>):</span>
<span id="cb4-9"><a href="genai-tools.html#cb4-9" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="cf">await</span> chat_client.stream_async(</span>
<span id="cb4-10"><a href="genai-tools.html#cb4-10" aria-hidden="true" tabindex="-1"></a>      user_input,</span>
<span id="cb4-11"><a href="genai-tools.html#cb4-11" aria-hidden="true" tabindex="-1"></a>      content<span class="op">=</span><span class="st">"all"</span></span>
<span id="cb4-12"><a href="genai-tools.html#cb4-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-13"><a href="genai-tools.html#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> chat.append_message_stream(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-tool-call-ui.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Screenshot of a tool result."><img src="../images/genai-tool-call-ui.png" class="rounded shadow img-fluid figure-img" alt="Screenshot of a tool result."></a></p>
<figcaption>Screenshot of a tool result.</figcaption>
</figure>
</div>
<p>Once the tool call is made, you can expand the <code>&lt;details&gt;</code> of the tool call to see what the model requested for arguments as well as the result sent to the model.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-tool-result-ui.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Screenshot of tool call result expanded."><img src="../images/genai-tool-result-ui.png" class="rounded shadow img-fluid figure-img" alt="Screenshot of tool call result expanded."></a></p>
<figcaption>Screenshot of tool call result expanded.</figcaption>
</figure>
</div>
<p>Also, for tools that take a while to run, the user is notified of what tool is running along with a bouncing dot to indicate that the tool is still running.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-tool-call-running-ui.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Screenshot of a tool call running."><img src="../images/genai-tool-call-running-ui.gif" class="rounded shadow img-fluid figure-img" alt="Screenshot of a tool call running."></a></p>
<figcaption>Screenshot of a tool call running.</figcaption>
</figure>
</div>
<p>And, in the case of an error, the user is also notified of the error.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-tool-call-error-ui.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Screenshot of a tool call error."><img src="../images/genai-tool-call-error-ui.png" class="rounded shadow img-fluid figure-img" alt="Screenshot of a tool call error."></a></p>
<figcaption>Screenshot of a tool call error.</figcaption>
</figure>
</div>
<p>In general, these default displays should be enough to let your users know what the LLM is requesting/receiving to help generate their responses.</p>
</section>
</section>
<section id="reactivity" class="level2">
<h2 class="anchored" data-anchor-id="reactivity">Reactivity</h2>
<p>Combining tool calling with <a href="reactive-foundations.html">reactivity</a> is a powerful technique that can effectively let the LLM interact with the app. Here, we’ll explore a few general patterns for doing this.</p>
<section id="updating-inputs" class="level3">
<h3 class="anchored" data-anchor-id="updating-inputs">Updating inputs</h3>
<p>The most basic way to hand over control to the LLM is to have it update reactive <code>input</code>(s). The core idea is to wrap a <code>ui.update_*()</code> call in a tool function and register that function with the <code>chat_client</code>. Then, when a user asks the LLM to update an input, it is able to do so.</p>
<details>
<summary>
client.py
</summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="genai-tools.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatAnthropic</span>
<span id="cb5-2"><a href="genai-tools.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> ui</span>
<span id="cb5-3"><a href="genai-tools.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="genai-tools.html#cb5-4" aria-hidden="true" tabindex="-1"></a>SLIDER_ID <span class="op">=</span> <span class="st">"slider"</span></span>
<span id="cb5-5"><a href="genai-tools.html#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="genai-tools.html#cb5-6" aria-hidden="true" tabindex="-1"></a>chat_client <span class="op">=</span> ChatAnthropic(</span>
<span id="cb5-7"><a href="genai-tools.html#cb5-7" aria-hidden="true" tabindex="-1"></a>    system_prompt<span class="op">=</span>(</span>
<span id="cb5-8"><a href="genai-tools.html#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"You are a helpful assistant in the sidebar of a Shiny app."</span></span>
<span id="cb5-9"><a href="genai-tools.html#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"You have a tool available to you to update a slider in the main panel of the app."</span></span>
<span id="cb5-10"><a href="genai-tools.html#cb5-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-11"><a href="genai-tools.html#cb5-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-12"><a href="genai-tools.html#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="genai-tools.html#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_slider(value: <span class="bu">int</span>):</span>
<span id="cb5-14"><a href="genai-tools.html#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Update the slider in the main panel with the provided value"</span></span>
<span id="cb5-15"><a href="genai-tools.html#cb5-15" aria-hidden="true" tabindex="-1"></a>    ui.update_slider(SLIDER_ID, value<span class="op">=</span>value)</span>
<span id="cb5-16"><a href="genai-tools.html#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="genai-tools.html#cb5-17" aria-hidden="true" tabindex="-1"></a>chat_client.register_tool(update_slider)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>
app.py
</summary>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="genai-tools.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> client <span class="im">import</span> chat_client, SLIDER_ID</span>
<span id="cb6-2"><a href="genai-tools.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> ui</span>
<span id="cb6-3"><a href="genai-tools.html#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="genai-tools.html#cb6-4" aria-hidden="true" tabindex="-1"></a>ui.input_slider(SLIDER_ID, <span class="st">"Value"</span>, value<span class="op">=</span><span class="dv">50</span>, <span class="bu">min</span><span class="op">=</span><span class="dv">0</span>, <span class="bu">max</span><span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb6-5"><a href="genai-tools.html#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="genai-tools.html#cb6-6" aria-hidden="true" tabindex="-1"></a>welcome <span class="op">=</span> <span class="st">"Welcome! Try asking me to &lt;span class='suggestion'&gt;update the slider to 80&lt;/span&gt; "</span></span>
<span id="cb6-7"><a href="genai-tools.html#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="genai-tools.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ui.sidebar(width<span class="op">=</span><span class="dv">350</span>):</span>
<span id="cb6-9"><a href="genai-tools.html#cb6-9" aria-hidden="true" tabindex="-1"></a>    chat <span class="op">=</span> ui.Chat(<span class="st">"chat"</span>)</span>
<span id="cb6-10"><a href="genai-tools.html#cb6-10" aria-hidden="true" tabindex="-1"></a>    chat.ui(messages<span class="op">=</span>[welcome])</span>
<span id="cb6-11"><a href="genai-tools.html#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="genai-tools.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="at">@chat.on_user_submit</span></span>
<span id="cb6-13"><a href="genai-tools.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> _(user_input: <span class="bu">str</span>):</span>
<span id="cb6-14"><a href="genai-tools.html#cb6-14" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="cf">await</span> chat_client.stream_async(user_input)</span>
<span id="cb6-15"><a href="genai-tools.html#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> chat.append_message_stream(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-tool-call-slider-ui.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Screenshot of a tool call that updated the slider from 50 to 80."><img src="../images/genai-tool-call-slider-ui.png" class="rounded shadow img-fluid figure-img" alt="Screenshot of a tool call that updated the slider from 50 to 80."></a></p>
<figcaption>Screenshot of a tool call that updated the slider from 50 to 80.</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Where might this be useful?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The basic example above illustrates the idea using minimal code, but the app itself is not particularly useful. For brevity sake, we won’t fully explore compelling applications here, but in general, updating inputs can be useful for:</p>
<ul>
<li>Navigating complex UI (i.e., lots of tabs, controls, etc)
<ul>
<li>Allow users describe to what they want without finding it</li>
</ul></li>
<li>Combine with <a href="genai-chatbots.html#suggest-input">input suggestions</a> to:
<ul>
<li>Guide user to interesting states</li>
<li>Save clicks</li>
</ul></li>
</ul>
</div>
</div>
</section>
<section id="managing-state" class="level3">
<h3 class="anchored" data-anchor-id="managing-state">Managing state</h3>
<p>In Shiny, a reactive value can derive from either an input <a href="../components/index.html">component</a> (e.g., <code>ui.input_select()</code>, etc.) or an entirely server-side <code>reactive.value()</code>. Generally speaking, the latter approach is useful for tracking state that may not exist in the UI (e.g., authentication, user activity, etc.). Similar to how we can equip the LLM to update an input component, we can also equip it to update a reactive value to have it drive the app’s state.</p>
<p>The sidebot template (<a href="genai-tools.html#why-tool-calling">mentioned at the top</a> of this article) illustrates a particularly powerful application of managing state. In this case, the state is an SQL query. When that state changes, it triggers a reactive data frame (<code>current_data</code>) to be updated, which in turn updates all the downstream views of the data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="genai-tools.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb7-2"><a href="genai-tools.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> reactive</span>
<span id="cb7-3"><a href="genai-tools.html#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="genai-tools.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># An SQL query</span></span>
<span id="cb7-5"><a href="genai-tools.html#cb7-5" aria-hidden="true" tabindex="-1"></a>current_query <span class="op">=</span> reactive.value(<span class="st">""</span>)</span>
<span id="cb7-6"><a href="genai-tools.html#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="genai-tools.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reactively execute the SQL query and</span></span>
<span id="cb7-8"><a href="genai-tools.html#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># return the result as a data frame</span></span>
<span id="cb7-9"><a href="genai-tools.html#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="at">@reactive.calc</span></span>
<span id="cb7-10"><a href="genai-tools.html#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> current_data():</span>
<span id="cb7-11"><a href="genai-tools.html#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> current_query() <span class="op">==</span> <span class="st">""</span>:</span>
<span id="cb7-12"><a href="genai-tools.html#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> tips</span>
<span id="cb7-13"><a href="genai-tools.html#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> duckdb.query(current_query()).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The LLM is also provided a tool (<code>update_dashboard()</code>) which takes an SQL query as input, and sets a new value for the <code>current_query</code> reactive value.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="genai-tools.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Annotated</span>
<span id="cb8-2"><a href="genai-tools.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="genai-tools.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> update_dashboard(</span>
<span id="cb8-4"><a href="genai-tools.html#cb8-4" aria-hidden="true" tabindex="-1"></a>    query: Annotated[<span class="bu">str</span>, <span class="st">'A DuckDB SQL query; must be a SELECT statement, or "".'</span>]</span>
<span id="cb8-5"><a href="genai-tools.html#cb8-5" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb8-6"><a href="genai-tools.html#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Modifies the data presented in the data dashboard based on the provided SQL query"</span></span>
<span id="cb8-7"><a href="genai-tools.html#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="cf">with</span> reactive.lock():</span>
<span id="cb8-8"><a href="genai-tools.html#cb8-8" aria-hidden="true" tabindex="-1"></a>        current_query.<span class="bu">set</span>(query)</span>
<span id="cb8-9"><a href="genai-tools.html#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> reactive.flush()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reactive locking
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since this tool runs within a <a href="genai-tools.html#non-blocking-streams">non-blocking message stream</a> (i.e., <code>.append_message_stream()</code>), in order to prevent race conditions, it must lock the reactivity graph when updating reactive value(s). If the tool were, instead, running in a <a href="genai-chatbots.html#message-stream-context">blocking stream</a>, the <code>reactive.lock()</code> and <code>reactive.flush()</code> wouldn’t be necessary.</p>
</div>
</div>
<p>The final crucial piece is that, in order for the LLM to generate accurate SQL, it needs to know the schema of the dataset. This is done by passing the table schema to the LLM’s <a href="genai-chatbots.html#models--prompts">system prompt</a>.</p>
<p>Since the general pattern of having a tool to update a reactive data frame via SQL is so useful, the <a href="../templates/querychat/index.html">querychat</a> package generalizes this pattern to make it more accessible and easier to use.</p>
</section>
</section>
<section id="custom-display" class="level2">
<h2 class="anchored" data-anchor-id="custom-display">Custom tool display</h2>
<p>Customizing how tool results are displayed can be useful for a variety of reasons. For example, you may want to style results differently, or implement something more sophisticated, such as displaying a map or a table.</p>
<p>To customize the result display, you can:</p>
<ol type="1">
<li>Subclass the <a href="https://posit-dev.github.io/chatlas/reference/types.ContentToolResult.html"><code>chatlas.ContentToolResult</code> class</a>.</li>
<li>Override the <code>tagify()</code> method. This can return any valid <code>ui.Chat()</code> message content (i.e., a markdown string or Shiny UI).</li>
<li>Return an instance of this subclass from your tool function.</li>
</ol>
<p>The basic example below would just style the tool result differently than the default:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="genai-tools.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ContentToolResult</span>
<span id="cb9-2"><a href="genai-tools.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="genai-tools.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WeatherToolResult(ContentToolResult):</span>
<span id="cb9-4"><a href="genai-tools.html#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> tagify(<span class="va">self</span>):</span>
<span id="cb9-5"><a href="genai-tools.html#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.error:</span>
<span id="cb9-6"><a href="genai-tools.html#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">super</span>().tagify()</span>
<span id="cb9-7"><a href="genai-tools.html#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-8"><a href="genai-tools.html#cb9-8" aria-hidden="true" tabindex="-1"></a>            args <span class="op">=</span> <span class="va">self</span>.arguments</span>
<span id="cb9-9"><a href="genai-tools.html#cb9-9" aria-hidden="true" tabindex="-1"></a>            params <span class="op">=</span> <span class="st">", "</span>.join(<span class="ss">f"</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> k, v <span class="kw">in</span> args.items())</span>
<span id="cb9-10"><a href="genai-tools.html#cb9-10" aria-hidden="true" tabindex="-1"></a>            temp <span class="op">=</span> <span class="va">self</span>.value[<span class="st">"temperature_2m"</span>]</span>
<span id="cb9-11"><a href="genai-tools.html#cb9-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> (</span>
<span id="cb9-12"><a href="genai-tools.html#cb9-12" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"✅ Tool call of `</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">(</span><span class="sc">{</span>params<span class="sc">}</span><span class="ss">)` "</span></span>
<span id="cb9-13"><a href="genai-tools.html#cb9-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"gave temperature of: </span><span class="sc">{temp}</span><span class="st"> °C</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb9-14"><a href="genai-tools.html#cb9-14" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb9-15"><a href="genai-tools.html#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="genai-tools.html#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_current_weather(latitude: <span class="bu">float</span>, longitude: <span class="bu">float</span>):</span>
<span id="cb9-17"><a href="genai-tools.html#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Get the current temperature given a latitude and longitude."""</span></span>
<span id="cb9-18"><a href="genai-tools.html#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="genai-tools.html#cb9-19" aria-hidden="true" tabindex="-1"></a>    lat_lng <span class="op">=</span> <span class="ss">f"latitude=</span><span class="sc">{</span>latitude<span class="sc">}</span><span class="ss">&amp;longitude=</span><span class="sc">{</span>longitude<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb9-20"><a href="genai-tools.html#cb9-20" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="ss">f"https://api.open-meteo.com/v1/forecast?</span><span class="sc">{</span>lat_lng<span class="sc">}</span><span class="ss">&amp;current=temperature_2m,wind_speed_10m&amp;hourly=temperature_2m,relative_humidity_2m,wind_speed_10m"</span></span>
<span id="cb9-21"><a href="genai-tools.html#cb9-21" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb9-22"><a href="genai-tools.html#cb9-22" aria-hidden="true" tabindex="-1"></a>    json <span class="op">=</span> response.json()</span>
<span id="cb9-23"><a href="genai-tools.html#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> WeatherToolResult(value<span class="op">=</span>json[<span class="st">"current"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Keep in mind that <a href="genai-chatbots.html#interactive-messages">Shiny UI can be included in messages</a>, so you could do something like diplay a <a href="jupyter-widgets.html">Jupyter Widget</a>.</p>
<details>
<summary>
Show code
</summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="genai-tools.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ipywidgets</span>
<span id="cb10-2"><a href="genai-tools.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shinywidgets <span class="im">import</span> register_widget, output_widget</span>
<span id="cb10-3"><a href="genai-tools.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipyleaflet <span class="im">import</span> Map, CircleMarker</span>
<span id="cb10-4"><a href="genai-tools.html#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="genai-tools.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WeatherToolResult(ContentToolResult):</span>
<span id="cb10-6"><a href="genai-tools.html#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> tagify(<span class="va">self</span>):</span>
<span id="cb10-7"><a href="genai-tools.html#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.error:</span>
<span id="cb10-8"><a href="genai-tools.html#cb10-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">super</span>().tagify()</span>
<span id="cb10-9"><a href="genai-tools.html#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="genai-tools.html#cb10-10" aria-hidden="true" tabindex="-1"></a>        args <span class="op">=</span> <span class="va">self</span>.arguments</span>
<span id="cb10-11"><a href="genai-tools.html#cb10-11" aria-hidden="true" tabindex="-1"></a>        loc <span class="op">=</span> (args[<span class="st">"latitude"</span>], args[<span class="st">"longitude"</span>])</span>
<span id="cb10-12"><a href="genai-tools.html#cb10-12" aria-hidden="true" tabindex="-1"></a>        info <span class="op">=</span> (</span>
<span id="cb10-13"><a href="genai-tools.html#cb10-13" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"&lt;h6&gt;Current weather&lt;/h6&gt;"</span></span>
<span id="cb10-14"><a href="genai-tools.html#cb10-14" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Temperature: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>value[<span class="st">'temperature_2m'</span>]<span class="sc">}</span><span class="ss">°C&lt;br&gt;"</span></span>
<span id="cb10-15"><a href="genai-tools.html#cb10-15" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Wind: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>value[<span class="st">'wind_speed_10m'</span>]<span class="sc">}</span><span class="ss"> m/s&lt;br&gt;"</span></span>
<span id="cb10-16"><a href="genai-tools.html#cb10-16" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Time: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>value[<span class="st">'time'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb10-17"><a href="genai-tools.html#cb10-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-18"><a href="genai-tools.html#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="genai-tools.html#cb10-19" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> Map(center<span class="op">=</span>loc, zoom<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb10-20"><a href="genai-tools.html#cb10-20" aria-hidden="true" tabindex="-1"></a>        m.add_layer(</span>
<span id="cb10-21"><a href="genai-tools.html#cb10-21" aria-hidden="true" tabindex="-1"></a>            CircleMarker(location<span class="op">=</span>loc, popup<span class="op">=</span>ipywidgets.HTML(info))</span>
<span id="cb10-22"><a href="genai-tools.html#cb10-22" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-23"><a href="genai-tools.html#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="genai-tools.html#cb10-24" aria-hidden="true" tabindex="-1"></a>        register_widget(<span class="va">self</span>.<span class="bu">id</span>, m)</span>
<span id="cb10-25"><a href="genai-tools.html#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> output_widget(<span class="va">self</span>.<span class="bu">id</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-tool-call-custom-ui.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Screenshot of a tool result rendered as an interactive map"><img src="../images/genai-tool-call-custom-ui.png" class="rounded shadow img-fluid figure-img" alt="Screenshot of a tool result rendered as an interactive map"></a></p>
<figcaption>Screenshot of a tool result rendered as an interactive map</figcaption>
</figure>
</div>
<!---
TODO: discuss streaming progress

async def get_current_temperature(latitude: float, longitude: float):
    "Get the current weather given a latitude and longitude."
    with chat.message_stream() as stream:
        stream.append("Querying the weather service...")
        temp = get_current_weather(latitude, longitude)
        stream.replace()
        stream.append(f"<details><summary>Tool result</summary> The temperature is {temp} at {latitude}, {longitude}.</details>")

    return temp
--->
<!---
TODO: discuss prompting the user for input (when we have the API for it)
--->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="genai-stream.html" class="pagination-link" aria-label="Streaming">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Streaming</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="genai-structured-data.html" class="pagination-link" aria-label="Structured data">
        <span class="nav-page-text">Structured data</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Proudly supported by <a href="https://www.posit.co/" class="no-icon"><img src="../images/posit-logo-black.svg" alt="Posit" width="80" style="padding-left: 3px;vertical-align:text-top;"></a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/posit-dev/py-shiny-site/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/posit-dev/py-shiny-site/edit/main/docs/genai-tools.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://discord.gg/yMGCamUMnS">
      <i class="bi bi-discord" role="img" aria-label="Shiny Discord">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/posit-dev/py-shiny/">
      <i class="bi bi-github" role="img" aria-label="Shiny for Python Github">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/posit_pbc">
      <i class="bi bi-twitter" role="img" aria-label="Posit Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/playlist?list=PL9HYL-VRX0oRbLoj3FyL5zeASU5FMDgVe">
      <i class="bi bi-youtube" role="img" aria-label="Shiny YouTube Playlist">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"fade","descPosition":"bottom","loop":false,"openEffect":"fade","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>