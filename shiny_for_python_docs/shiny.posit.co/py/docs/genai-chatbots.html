<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chatbots ‚Äì Shiny for Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="genai-stream.html" rel="next">
<link href="genai-inspiration.html" rel="prev">
<link href="../favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-888ef42a095209a13a17dbfda2cb877d.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-06a6b8726800c70458725a52052b40c7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content="..">
<script src="../site_libs/quarto-contrib/shinylive-0.10.4/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="../site_libs/quarto-contrib/shinylive-0.10.4/shinylive/run-python-blocks.js" type="module"></script>
<link href="../site_libs/quarto-contrib/shinylive-0.10.4/shinylive/shinylive.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
  // Redirect URLs like https://shiny.posit.co/py to
  // https://shiny.posit.co/py/ (with trailing slash). This is needed for
  // relative paths to work correctly. Unfortunately, Netlify cannot have a
  // redirect that adds or removes a trailing slash.
  if (
    !window.location.pathname.endsWith(".html") &&
    !window.location.pathname.endsWith("/")
  ) {
    window.location.replace(window.location.href + "/");
  }
</script>

<!-- Google Tag Manager -->
<script>
  // prettier-ignore
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KHBDBW7');
</script>
<!-- End Google Tag Manager -->

<!-- Add rel="noopener noreferrer" to each target="_blank" -->
<script type="text/javascript">
  window.addEventListener("load", () =>
    [...document.querySelectorAll("a[target=_blank]")].forEach((lnk) =>
      lnk.setAttribute("rel", "noopener noreferrer")
    )
  );
</script>
<!-- End Add rel="noopener noreferrer" to each target="_blank" -->

<script type="text/javascript">
  (function () {
    function addShinyliveEditLinks() {
      const codeWithLink = document.querySelectorAll(
        ".sourceCode[data-shinylive]"
      );
      codeWithLink.forEach((el) => {
        el.classList.add("code-with-shinylive-link");
        const url = el.dataset.shinylive;

        // <a class="edit-shinylive-button btn btn-link" href="https://shiny.posit.co/py/docs/&lt;%=&#32;app.shinylive&#32;%&gt;" data-bs-toggle="tooltip" data-bs-title="Edit in Shinylive" data-bs-placement="bottom">
        //  <i class="bi bi-lightning-fill"></i> <span class="visually-hidden">Edit in Shinylive</span>
        // </a>

        const link = document.createElement("a");
        link.classList.add("edit-shinylive-button", "btn", "btn-link");
        link.href = url;
        link.dataset.bsToggle = "tooltip";
        link.dataset.bsTitle = "Edit in Shinylive";
        link.dataset.bsPlacement = "bottom";

        const icon = document.createElement("i");
        icon.classList.add("bi", "bi-lightning-fill");
        link.appendChild(icon);

        const span = document.createElement("span");
        span.classList.add("visually-hidden");
        span.innerText = "Edit in Shinylive";
        link.appendChild(span);

        const btnCopy = el.querySelector(".code-copy-button");
        if (btnCopy) {
          btnCopy.parentElement.appendChild(link);
        } else {
          if (el.matches("pre")) {
            el.appendChild(link);
          } else {
            el.querySelector("pre").appendChild(link);
          }
        }

        if (window.bootstrap?.Tooltip) {
          new bootstrap.Tooltip(link);
        }
        el.removeAttribute("data-shinylive");
      });
    }

    function addWhatsShinyExpressTooltip() {
      const tooltipContents = `<p><strong>Shiny Express</strong> is a new, streamlined way to write a Shiny app.</p>
    <p><strong>Shiny Core</strong> refers to the original, functional Shiny syntax, which is still a great way to write Shiny apps.</p>
    <p class="fw-600" style="font-size:0.85em;"><a href="https://shiny.posit.co/blog/posts/shiny-express/">Read more <i class="bi bi-chevron-right align-text-top"></i></a></p>`;

      const tooltipDisplay = `<i class="bi bi-question-circle-fill d-inline d-sm-none"></i><span class="d-none d-sm-inline">What's this?</span>`;

      document
        .querySelectorAll(".panel-tabset.shiny-mode-tabset")
        .forEach(function (tabset) {
          const trigger = document.createElement("div");
          trigger.classList.add("what-shiny-express", "text-white");
          trigger.tabIndex = 0;
          trigger.innerHTML = tooltipDisplay;
          tabset.appendChild(trigger);

          if (!window.bootstrap?.Popover) {
            return;
          }

          new window.bootstrap.Popover(trigger, {
            html: true,
            title: "Express vs Core",
            content: tooltipContents,
            placement: "auto",
            trigger: "focus",
            container: tabset,
          });
        });
    }

    function handlePanelVariants() {
      document.querySelectorAll(".panel-pills > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-pills");
      });
      document.querySelectorAll(".panel-underline > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-underline");
      });
      document.querySelectorAll(".shiny-mode-tabset > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-underline");
      });
    }

    function onLoad() {
      addShinyliveEditLinks();
      addWhatsShinyExpressTooltip();
      handlePanelVariants();
    }

    document.readyState === "loading"
      ? document.addEventListener("DOMContentLoaded", onLoad)
      : onLoad();
  })();
</script>

<!-- <div
  class="alert alert-primary text-center mb-0 border-0"
  style="padding: 0.6rem"
  role="alert"
>
  <p class="d-md-inline my-0 me-md-4 p-90">
    <strong>üéâ Introducing Shiny Express</strong>
  </p>
  <p class="d-md-inline my-0 p-90 me-md-4">
    A simpler way to write and learn Shiny.
  </p>
  <p class="d-md-inline my-0 p-90 me-md-4">
    <a
      href="https://shiny.posit.co/blog/posts/shiny-express/"
      target="_blank"
      style="color: #00314e"
      >Learn more</a
    >.
  </p>
</div> -->


<meta property="og:title" content="Chatbots ‚Äì Shiny for Python">
<meta property="og:description" content="Build interactive web applications easily with the power of Python‚Äôs data and scientific stack.">
<meta property="og:image" content="https://shiny.posit.co/py/images/shiny-for-python.jpg">
<meta property="og:site_name" content="Shiny for Python">
<meta property="og:locale" content="es_ES">
<meta name="twitter:title" content="Shiny for Python">
<meta name="twitter:description" content="Build interactive web applications easily with the power of Python‚Äôs data and scientific stack.">
<meta name="twitter:image" content="https://shiny.posit.co/py/images/shiny-for-python.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../shiny-for-python.svg" alt="The logo for Shiny for Python" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Shiny for Python</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../get-started/index.html"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="overview.html" aria-current="page"> 
<span class="menu-text">Concepts</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="genai-chatbots.html#" id="nav-menu-components" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Components</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-components">    
        <li>
    <a class="dropdown-item" href="../components/index.html"><i class="bi bi-sliders" role="img">
</i> 
 <span class="dropdown-text">Components</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../layouts/index.html"><i class="bi bi-layout-text-window-reverse" role="img">
</i> 
 <span class="dropdown-text">Layouts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../templates/index.html"><i class="bi bi-code-square" role="img">
</i> 
 <span class="dropdown-text">Templates</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../gallery/index.html"> 
<span class="menu-text">Gallery</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://shinylive.io/py/examples/" target="_blank"> 
<span class="menu-text">Playground</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="genai-chatbots.html#" id="nav-menu-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reference">    
        <li>
    <a class="dropdown-item" href="../api/express/index.html">
 <span class="dropdown-text">Shiny Express</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api/core/index.html">
 <span class="dropdown-text">Shiny Core</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api/testing/index.html">
 <span class="dropdown-text">Testing</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://discord.gg/yMGCamUMnS" title="" class="quarto-navigation-tool px-1" aria-label="Shiny Discord"><i class="bi bi-discord"></i></a>
    <a href="https://github.com/posit-dev/py-shiny/" title="" class="quarto-navigation-tool px-1" aria-label="Shiny for Python Github"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="genai-inspiration.html"><span class="emoji-icon">ü§ñ</span> <strong>Generative AI</strong></a></li><li class="breadcrumb-item"><a href="genai-chatbots.html">Chatbots</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">üìå</span> <strong>Essentials</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="user-interfaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">User interfaces</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">ü§ñ</span> <strong>Generative AI</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-inspiration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Get inspired</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-chatbots.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Chatbots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-stream.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Streaming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tool calling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-structured-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structured data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-rag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAG</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">üé®</span> <strong>User interfaces</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="jupyter-widgets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jupyter Widgets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-dynamic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic UI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">UI as HTML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-customize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Customizing UI</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">‚ö°</span> <strong>Reactivity</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-mutable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mutable objects</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">üìù</span> <strong>Syntax modes</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-vs-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Express vs.&nbsp;Core</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-or-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Choosing a syntax</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-in-depth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Express in depth</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-to-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transition to Core</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">üì¶</span> <strong>Modules</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="modules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shiny Modules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="module-communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Module Communication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">üß™</span> <strong>Testing</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="unit-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="end-to-end-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End-to-End Testing Your App</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">üèóÔ∏è</span> <strong>Extending</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="custom-component-one-off.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom JavaScript component</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="custom-components-pkg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom components package</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">üìä</span> <strong>Comparisons</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="comp-streamlit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Streamlit</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="comp-r-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shiny for R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">üß©</span> <strong>Miscellaneous</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="nonblocking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Non-blocking operations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="routing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Routing</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="genai-chatbots.html#get-started" id="toc-get-started" class="nav-link active" data-scroll-target="#get-started">Get started</a>
  <ul class="collapse">
  <li><a href="genai-chatbots.html#choose-a-template" id="toc-choose-a-template" class="nav-link" data-scroll-target="#choose-a-template">Choose a template</a></li>
  <li><a href="genai-chatbots.html#inspect-the-code" id="toc-inspect-the-code" class="nav-link" data-scroll-target="#inspect-the-code">Inspect the code</a></li>
  <li><a href="genai-chatbots.html#models-prompts" id="toc-models-prompts" class="nav-link" data-scroll-target="#models-prompts">Models &amp; prompts</a></li>
  </ul></li>
  <li><a href="genai-chatbots.html#add-messages" id="toc-add-messages" class="nav-link" data-scroll-target="#add-messages">Add messages</a>
  <ul class="collapse">
  <li><a href="genai-chatbots.html#startup-messages" id="toc-startup-messages" class="nav-link" data-scroll-target="#startup-messages">On startup</a></li>
  <li><a href="genai-chatbots.html#on-user-submit" id="toc-on-user-submit" class="nav-link" data-scroll-target="#on-user-submit">On user submit</a></li>
  </ul></li>
  <li><a href="genai-chatbots.html#bookmark-messages" id="toc-bookmark-messages" class="nav-link" data-scroll-target="#bookmark-messages">Bookmark messages</a></li>
  <li><a href="genai-chatbots.html#layout" id="toc-layout" class="nav-link" data-scroll-target="#layout">Layout</a>
  <ul class="collapse">
  <li><a href="genai-chatbots.html#fill" id="toc-fill" class="nav-link" data-scroll-target="#fill">Fill</a></li>
  <li><a href="genai-chatbots.html#sidebar" id="toc-sidebar" class="nav-link" data-scroll-target="#sidebar">Sidebar</a></li>
  <li><a href="genai-chatbots.html#card-layout" id="toc-card-layout" class="nav-link" data-scroll-target="#card-layout">Card layout</a></li>
  </ul></li>
  <li><a href="genai-chatbots.html#theming" id="toc-theming" class="nav-link" data-scroll-target="#theming">Theming</a>
  <ul class="collapse">
  <li><a href="genai-chatbots.html#custom-css" id="toc-custom-css" class="nav-link" data-scroll-target="#custom-css">Custom CSS</a></li>
  <li><a href="genai-chatbots.html#custom-icons" id="toc-custom-icons" class="nav-link" data-scroll-target="#custom-icons">Custom icons</a></li>
  </ul></li>
  <li><a href="genai-chatbots.html#recommend-input" id="toc-recommend-input" class="nav-link" data-scroll-target="#recommend-input">Recommend input</a>
  <ul class="collapse">
  <li><a href="genai-chatbots.html#suggest-input" id="toc-suggest-input" class="nav-link" data-scroll-target="#suggest-input">Suggest input</a></li>
  <li><a href="genai-chatbots.html#update-input" id="toc-update-input" class="nav-link" data-scroll-target="#update-input">Update input</a></li>
  </ul></li>
  <li><a href="genai-chatbots.html#interactive-messages" id="toc-interactive-messages" class="nav-link" data-scroll-target="#interactive-messages">Interactive messages</a></li>
  <li><a href="genai-chatbots.html#message-streams" id="toc-message-streams" class="nav-link" data-scroll-target="#message-streams">Message streams</a>
  <ul class="collapse">
  <li><a href="genai-chatbots.html#non-blocking-streams" id="toc-non-blocking-streams" class="nav-link" data-scroll-target="#non-blocking-streams">Non-blocking streams</a></li>
  <li><a href="genai-chatbots.html#message-stream-context" id="toc-message-stream-context" class="nav-link" data-scroll-target="#message-stream-context">Streaming context</a></li>
  </ul></li>
  <li><a href="genai-chatbots.html#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a>
  <ul class="collapse">
  <li><a href="genai-chatbots.html#error-handling" id="toc-error-handling" class="nav-link" data-scroll-target="#error-handling">Error handling</a></li>
  <li><a href="genai-chatbots.html#debugging" id="toc-debugging" class="nav-link" data-scroll-target="#debugging">Debugging</a></li>
  </ul></li>
  <li><a href="genai-chatbots.html#message-history" id="toc-message-history" class="nav-link" data-scroll-target="#message-history">Message history</a></li>
  <li><a href="genai-chatbots.html#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next steps</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/posit-dev/py-shiny-site/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/posit-dev/py-shiny-site/edit/main/docs/genai-chatbots.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KHBDBW7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="genai-inspiration.html"><span class="emoji-icon">ü§ñ</span> <strong>Generative AI</strong></a></li><li class="breadcrumb-item"><a href="genai-chatbots.html">Chatbots</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Chatbots</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this article, you‚Äôll learn how to build a chatbot powered by a Large Language Model (LLM) <code>shiny</code> and <a href="https://posit-dev.github.io/chatlas/"><code>chatlas</code></a>.</p>
<section id="get-started" class="level2">
<h2 class="anchored" data-anchor-id="get-started">Get started</h2>
<section id="choose-a-template" class="level3">
<h3 class="anchored" data-anchor-id="choose-a-template">Choose a template</h3>
<p>Pick from the following LLM providers below to start your chatbot. Copy &amp; paste the relevant <code>shiny create</code> terminal command to get the relevant source files on your machine.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Ollama</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Anthropic</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">OpenAI</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Google</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Bedrock Anthropic</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">Azure OpenAI</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false">LangChain</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-8" role="tab" aria-controls="tabset-1-8" aria-selected="false">Other</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-9" role="tab" aria-controls="tabset-1-9" aria-selected="false">Help me choose!</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="genai-chatbots.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> chat-ai-ollama</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="genai-chatbots.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> chat-ai-anthropic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="genai-chatbots.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> chat-ai-openai</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="genai-chatbots.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> chat-ai-gemini</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="genai-chatbots.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> chat-ai-anthropic-aws</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="genai-chatbots.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> chat-ai-azure-openai</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="genai-chatbots.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> chat-ai-langchain</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-8-tab">
<p><code>chatlas</code> supports a <a href="https://posit-dev.github.io/chatlas/#model-providers">wide variety</a> of LLM providers including Vertex, Snowflake, Groq, Perplexity, and more. In this case, you can start from any template and swap out the <code>chat_client</code> with the relevant chat constructor (e.g., <code>ChatVertex()</code>).</p>
</div>
<div id="tabset-1-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-9-tab">
<p>If you‚Äôre not sure which provider to choose, <code>chatlas</code> provides a <a href="https://posit-dev.github.io/chatlas/#model-choice">great guide</a> to help you decide.</p>
</div>
</div>
</div>
<p>When you run the <code>shiny create</code> command, you‚Äôll be provided with some tips on where to obtain the necessary API keys (if any) and how to securely add them to your app.</p>
<p>Also, if you‚Äôre not ready to sign up for a cloud provider (e.g., Anthropic, OpenAI, etc.), you can run models locally (for free!) with the Ollama template. This is a great way to get started and learn about LLMs without any cost, and without sharing your data with a cloud provider.</p>
<p>Once your credentials (if any) are in place, <a href="../get-started/create-run.html#run-your-shiny-application">run the app</a>. Congrats, you now have a streaming chat interface powered by an LLM of your choice! üéâ</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/chat-quick-start.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Screenshot of a conversation with the Chat component."><img src="../images/chat-quick-start.png" class="rounded shadow mt-3 img-fluid figure-img" alt="Screenshot of a conversation with the Chat component."></a></p>
<figcaption>Screenshot of a conversation with the <code>Chat</code> component.</figcaption>
</figure>
</div>
</section>
<section id="inspect-the-code" class="level3">
<h3 class="anchored" data-anchor-id="inspect-the-code">Inspect the code</h3>
<p>Go ahead and open the <code>app.py</code> file from your template, you‚Äôll see something roughly like this:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="genai-chatbots.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatOllama</span>
<span id="cb8-2"><a href="genai-chatbots.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> ui</span>
<span id="cb8-3"><a href="genai-chatbots.html#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="genai-chatbots.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Might instead be ChatAnthropic, ChatOpenAI, or some other provider</span></span>
<span id="cb8-5"><a href="genai-chatbots.html#cb8-5" aria-hidden="true" tabindex="-1"></a>chat_client <span class="op">=</span> ChatOllama(model<span class="op">=</span><span class="st">"llama3.2"</span>)</span>
<span id="cb8-6"><a href="genai-chatbots.html#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="genai-chatbots.html#cb8-7" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"my_chat"</span>)</span>
<span id="cb8-8"><a href="genai-chatbots.html#cb8-8" aria-hidden="true" tabindex="-1"></a>chat.ui()</span>
<span id="cb8-9"><a href="genai-chatbots.html#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="genai-chatbots.html#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="at">@chat.on_user_submit</span></span>
<span id="cb8-11"><a href="genai-chatbots.html#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> handle_user_input(user_input: <span class="bu">str</span>):</span>
<span id="cb8-12"><a href="genai-chatbots.html#cb8-12" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="cf">await</span> chat_client.stream_async(user_input)</span>
<span id="cb8-13"><a href="genai-chatbots.html#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> chat.append_message_stream(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="genai-chatbots.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatOllama</span>
<span id="cb9-2"><a href="genai-chatbots.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> ui, App</span>
<span id="cb9-3"><a href="genai-chatbots.html#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="genai-chatbots.html#cb9-4" aria-hidden="true" tabindex="-1"></a>app_ui <span class="op">=</span> ui.page_fixed(</span>
<span id="cb9-5"><a href="genai-chatbots.html#cb9-5" aria-hidden="true" tabindex="-1"></a>    ui.chat_ui(<span class="bu">id</span><span class="op">=</span><span class="st">"my_chat"</span>)</span>
<span id="cb9-6"><a href="genai-chatbots.html#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-7"><a href="genai-chatbots.html#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="genai-chatbots.html#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> server(<span class="bu">input</span>):</span>
<span id="cb9-9"><a href="genai-chatbots.html#cb9-9" aria-hidden="true" tabindex="-1"></a>    chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"my_chat"</span>)</span>
<span id="cb9-10"><a href="genai-chatbots.html#cb9-10" aria-hidden="true" tabindex="-1"></a>    chat_client <span class="op">=</span> ChatOllama(model<span class="op">=</span><span class="st">"llama3.2"</span>)</span>
<span id="cb9-11"><a href="genai-chatbots.html#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="genai-chatbots.html#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@chat.on_user_submit</span></span>
<span id="cb9-13"><a href="genai-chatbots.html#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> handle_user_input(user_input: <span class="bu">str</span>):</span>
<span id="cb9-14"><a href="genai-chatbots.html#cb9-14" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> <span class="cf">await</span> chat_client.stream_async(user_input)</span>
<span id="cb9-15"><a href="genai-chatbots.html#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> chat.append_message_stream(response)</span>
<span id="cb9-16"><a href="genai-chatbots.html#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="genai-chatbots.html#cb9-17" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> App(app_ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>From here, we can see the key requirements for streaming reponses from an LLM:</p>
<ol type="1">
<li>Initialize a <code>chat_client</code> (e.g., <code>ChatOllama()</code>) to interact with the LLM.
<ul>
<li><a href="https://posit-dev.github.io/chatlas/"><code>chatlas</code></a> isn‚Äôt required for this, but it‚Äôs highly recommended.</li>
</ul></li>
<li>Initialize a <code>Chat()</code> instance.</li>
<li>Display it‚Äôs UI element with <code>chat.ui()</code>.
<ul>
<li>Here you can specify <a href="genai-chatbots.html#startup-messages">startup messages</a>, <a href="genai-chatbots.html#custom-icons">customize icons</a>, and more.</li>
</ul></li>
<li>Decorate a <code>@chat.on_user_submit</code> function to fire when the user submits input.
<ul>
<li>Here, <code>chat_client</code> generates a <code>response</code> stream, which is passed along to the <code>.append_message_stream()</code> method for display.</li>
</ul></li>
</ol>
<p>In this article, our primary focus is the UI portion of the chatbot (i.e., <code>chat</code>). That said, since LLM model choice and prompt design are so important for generating good responses, we‚Äôll briefly touch on that first.</p>
</section>
<section id="models-prompts" class="level3">
<h3 class="anchored" data-anchor-id="models-prompts">Models &amp; prompts</h3>
<p>With <code>chatlas</code>, it‚Äôs very easy to switch between the model and system prompt behind your <code>chat_client</code>. Just change the <code>model</code> and <code>system_prompt</code> parameters:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="genai-chatbots.html#cb10-1" aria-hidden="true" tabindex="-1"></a>chat_client <span class="op">=</span> ChatOllama(</span>
<span id="cb10-2"><a href="genai-chatbots.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  model<span class="op">=</span><span class="st">"llama3.2"</span>,</span>
<span id="cb10-3"><a href="genai-chatbots.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  system_prompt<span class="op">=</span><span class="st">"You are a helpful assistant"</span>,</span>
<span id="cb10-4"><a href="genai-chatbots.html#cb10-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you‚Äôre new to programming with LLMs, we <strong>highly recommend</strong> visiting the <code>chatlas</code> website for guidance on <a href="https://posit-dev.github.io/chatlas/get-started.html">where to start</a>, <a href="https://posit-dev.github.io/chatlas/#model-choice">choosing a model</a>, and <a href="https://posit-dev.github.io/chatlas/prompt-design.html">designing an effective system prompt</a>.</p>
<p>If you‚Äôre not yet ready learn about LLMs, that‚Äôs okay! We can still dive into <code>chat</code> UI features without knowing much about LLMs.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Model playground template
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Interactively experiment with different models and prompts with the playground template. It‚Äôs also a great learning resource on how to leverage reactivity for dynamic prompts and model selection.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="genai-chatbots.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> chat-ai-playground</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="add-messages" class="level2">
<h2 class="anchored" data-anchor-id="add-messages">Add messages</h2>
<section id="startup-messages" class="level3">
<h3 class="anchored" data-anchor-id="startup-messages">On startup</h3>
<p>Show message(s) when the chat first loads by providing <code>messages</code> to <code>chat.ui()</code>. Messages are interpreted as markdown, so you can use markdown (or HTML) to format the text as you like.</p>
<p>Startup messages are a great place to introduce the chatbot with a brief description of what it can do and, optionally, some <a href="genai-chatbots.html#suggest-input">input suggestions</a> to help the user get started quickly. Messages can also contain arbitrary Shiny UI <a href="../components/index.html">components</a>, so you could even include something like a <a href="../components/display-messages/tooltips/index.html">tooltip</a> to provide additional details on demand.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="genai-chatbots.html#cb12-1" aria-hidden="true" tabindex="-1"></a>chat.ui(</span>
<span id="cb12-2"><a href="genai-chatbots.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[<span class="st">"**Hello!** How can I help you today?"</span>]</span>
<span id="cb12-3"><a href="genai-chatbots.html#cb12-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="genai-chatbots.html#cb13-1" aria-hidden="true" tabindex="-1"></a>ui.chat_ui(</span>
<span id="cb13-2"><a href="genai-chatbots.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>,</span>
<span id="cb13-3"><a href="genai-chatbots.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[<span class="st">"**Hello!** How can I help you today?"</span>],</span>
<span id="cb13-4"><a href="genai-chatbots.html#cb13-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/chat-hello.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Screenshot of a chatbot with a welcome message."><img src="../images/chat-hello.png" class="rounded shadow d-block m-auto img-fluid figure-img" style="width:67.0%" alt="Screenshot of a chatbot with a welcome message."></a></p>
<figcaption>Screenshot of a chatbot with a welcome message.</figcaption>
</figure>
</div>
</section>
<section id="on-user-submit" class="level3">
<h3 class="anchored" data-anchor-id="on-user-submit">On user submit</h3>
<p>Every <code>chat</code> instance should have a <code>@chat.on_user_submit</code> callback. This is where you‚Äôll receive the user‚Äôs input and append a response to the chat. In your started template, the response <code>stream</code> is provided by <a href="https://posit-dev.github.io/chatlas/"><code>chatlas</code></a> via <code>chat_client.stream_async(prompt)</code>. As it turns out, <code>stream</code> is an <a href="https://stackoverflow.com/q/1756096">generator</a> of markdown strings, and the <code>.append_message_stream()</code> method can work with any generator of strings. This is useful to know if you want to:</p>
<ol type="1">
<li>Use another framework for reponse generation (e.g., <a href="https://www.langchain.com/">LangChain</a>).</li>
<li>Transform the stream as it‚Äôs being generated (e.g., capitalize the response).</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="genai-chatbots.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="at">@chat.on_user_submit</span></span>
<span id="cb14-2"><a href="genai-chatbots.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> _(user_input: <span class="bu">str</span>):</span>
<span id="cb14-3"><a href="genai-chatbots.html#cb14-3" aria-hidden="true" tabindex="-1"></a>    stream <span class="op">=</span> stream_generator(user_input)</span>
<span id="cb14-4"><a href="genai-chatbots.html#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> chat.append_message_stream(stream)</span>
<span id="cb14-5"><a href="genai-chatbots.html#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="genai-chatbots.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 'Wrap' the stream to capitialize the response</span></span>
<span id="cb14-7"><a href="genai-chatbots.html#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> stream_generator(user_input):</span>
<span id="cb14-8"><a href="genai-chatbots.html#cb14-8" aria-hidden="true" tabindex="-1"></a>    stream <span class="op">=</span> <span class="cf">await</span> chat_client.stream_async(user_input)</span>
<span id="cb14-9"><a href="genai-chatbots.html#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="cf">for</span> chunk <span class="kw">in</span> stream:</span>
<span id="cb14-10"><a href="genai-chatbots.html#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> chunk.upper()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--- TODO: write about the other options?
As we'll see later, there a couple other ways to append messages to the chat, like `chat.append_message()` and `with chat.message_stream_context()`.
--->
</section>
</section>
<section id="bookmark-messages" class="level2">
<h2 class="anchored" data-anchor-id="bookmark-messages">Bookmark messages</h2>
<p>When a Shiny app reloads, the app returns to it‚Äôs original state, unless the URL includes <a href="../api/express/session.Session.html">bookmarked</a> state.<a href="genai-chatbots.html#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Automatically updating the URL to include a bookmark of the chat state is a great way to help users return to their work if they accidentally refresh the page or unexpectedly lose their connection.</p>
<p>Adding bookmark support to an app generally requires some extra effort. At the very least, Shiny needs to know where and when to save state, and in some cases, how to save/restore it as well.<a href="genai-chatbots.html#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> The <code>.enable_bookmarking()</code> method makes this all a bit easier for bookmarking both the <code>chat</code> and <code>chat_client</code> instances.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="genai-chatbots.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatOllama</span>
<span id="cb15-2"><a href="genai-chatbots.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> ui</span>
<span id="cb15-3"><a href="genai-chatbots.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="genai-chatbots.html#cb15-4" aria-hidden="true" tabindex="-1"></a>chat_client <span class="op">=</span> ChatOllama(model<span class="op">=</span><span class="st">"llama3.2"</span>)</span>
<span id="cb15-5"><a href="genai-chatbots.html#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="genai-chatbots.html#cb15-6" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb15-7"><a href="genai-chatbots.html#cb15-7" aria-hidden="true" tabindex="-1"></a>chat.ui(messages<span class="op">=</span>[<span class="st">"Welcome!"</span>])</span>
<span id="cb15-8"><a href="genai-chatbots.html#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="genai-chatbots.html#cb15-9" aria-hidden="true" tabindex="-1"></a>chat.enable_bookmarking(</span>
<span id="cb15-10"><a href="genai-chatbots.html#cb15-10" aria-hidden="true" tabindex="-1"></a>    chat_client,</span>
<span id="cb15-11"><a href="genai-chatbots.html#cb15-11" aria-hidden="true" tabindex="-1"></a>    bookmark_store<span class="op">=</span><span class="st">"url"</span>, <span class="co"># or "server"</span></span>
<span id="cb15-12"><a href="genai-chatbots.html#cb15-12" aria-hidden="true" tabindex="-1"></a>    bookmark_on<span class="op">=</span><span class="st">"response"</span>, <span class="co"># or None</span></span>
<span id="cb15-13"><a href="genai-chatbots.html#cb15-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="genai-chatbots.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatOllama</span>
<span id="cb16-2"><a href="genai-chatbots.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> ui, App</span>
<span id="cb16-3"><a href="genai-chatbots.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="genai-chatbots.html#cb16-4" aria-hidden="true" tabindex="-1"></a>app_ui <span class="op">=</span> ui.page_fixed(</span>
<span id="cb16-5"><a href="genai-chatbots.html#cb16-5" aria-hidden="true" tabindex="-1"></a>    ui.chat_ui(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>, messages<span class="op">=</span>[<span class="st">"Welcome!"</span>])</span>
<span id="cb16-6"><a href="genai-chatbots.html#cb16-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-7"><a href="genai-chatbots.html#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="genai-chatbots.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> server(<span class="bu">input</span>):</span>
<span id="cb16-9"><a href="genai-chatbots.html#cb16-9" aria-hidden="true" tabindex="-1"></a>    chat_client <span class="op">=</span> ChatOllama(model<span class="op">=</span><span class="st">"llama3.2"</span>)</span>
<span id="cb16-10"><a href="genai-chatbots.html#cb16-10" aria-hidden="true" tabindex="-1"></a>    chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb16-11"><a href="genai-chatbots.html#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="genai-chatbots.html#cb16-12" aria-hidden="true" tabindex="-1"></a>    chat.enable_bookmarking(</span>
<span id="cb16-13"><a href="genai-chatbots.html#cb16-13" aria-hidden="true" tabindex="-1"></a>        chat_client,</span>
<span id="cb16-14"><a href="genai-chatbots.html#cb16-14" aria-hidden="true" tabindex="-1"></a>        bookmark_on<span class="op">=</span><span class="st">"response"</span>, <span class="co"># or None</span></span>
<span id="cb16-15"><a href="genai-chatbots.html#cb16-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-16"><a href="genai-chatbots.html#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="genai-chatbots.html#cb16-17" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> App(app_ui, server, bookmark_store<span class="op">=</span><span class="st">"url"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Adding this <code>.enable_bookmarking()</code> call handles the where, when, and how of bookmarking chat state:</p>
<ol type="1">
<li>Where (<code>store</code>)
<ul>
<li><code>"url"</code> store the state in the URL.</li>
<li><code>"server"</code> store the state on the server. Consider this over <code>"url"</code> if you want to support a large amount of state, or have other bookmark state that can‚Äôt be serialized to JSON.</li>
</ul></li>
<li>When (<code>bookmark_on</code>)
<ul>
<li><code>"response"</code>: triggers a bookmark when an <code>"assistant"</code> response is appended.</li>
<li><code>None</code>: don‚Äôt trigger a bookmark. This assumes you‚Äôll be triggering bookmarks through other means (e.g., a button).</li>
</ul></li>
<li>How is handled automatically by registering the relevant <code>on_bookmark</code> and <code>on_restore</code> callbacks.</li>
</ol>
<p>Also note that when <code>.enable_bookmarking()</code> triggers a bookmark for you, it‚Äôll also update the URL query string to include the bookmark state. This way, when the user unexpectedly loses connection, they can load the current URL to restore the chat state, or go back to the original URL to start over.</p>
</section>
<section id="layout" class="level2">
<h2 class="anchored" data-anchor-id="layout">Layout</h2>
<section id="fill" class="level3">
<h3 class="anchored" data-anchor-id="fill">Fill</h3>
<p>Fill the page on desktop (and mobile) with the <code>fillable=True</code> (and <code>fillable_mobile=True</code>) page options. This way, the input stays anchored to the bottom of the page, and the chat fills the remaining space.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="genai-chatbots.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> ui</span>
<span id="cb17-2"><a href="genai-chatbots.html#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="genai-chatbots.html#cb17-3" aria-hidden="true" tabindex="-1"></a>ui.page_opts(</span>
<span id="cb17-4"><a href="genai-chatbots.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  fillable<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb17-5"><a href="genai-chatbots.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  fillable_mobile<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb17-6"><a href="genai-chatbots.html#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-7"><a href="genai-chatbots.html#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="genai-chatbots.html#cb17-8" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb17-9"><a href="genai-chatbots.html#cb17-9" aria-hidden="true" tabindex="-1"></a>chat.ui(messages<span class="op">=</span>[<span class="st">"Welcome!"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="genai-chatbots.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> ui, App</span>
<span id="cb18-2"><a href="genai-chatbots.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="genai-chatbots.html#cb18-3" aria-hidden="true" tabindex="-1"></a>app_ui <span class="op">=</span> ui.page_fillable(</span>
<span id="cb18-4"><a href="genai-chatbots.html#cb18-4" aria-hidden="true" tabindex="-1"></a>    ui.chat_ui(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>, messages<span class="op">=</span>[<span class="st">"Welcome!"</span>]),</span>
<span id="cb18-5"><a href="genai-chatbots.html#cb18-5" aria-hidden="true" tabindex="-1"></a>    fillable_mobile<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb18-6"><a href="genai-chatbots.html#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-7"><a href="genai-chatbots.html#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="genai-chatbots.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> server(<span class="bu">input</span>):</span>
<span id="cb18-9"><a href="genai-chatbots.html#cb18-9" aria-hidden="true" tabindex="-1"></a>    chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb18-10"><a href="genai-chatbots.html#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="genai-chatbots.html#cb18-11" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> App(app_ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/chat-fill.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Screenshot of a chatbot filling the page."><img src="../images/chat-fill.png" class="rounded shadow d-block m-auto img-fluid figure-img" style="width:67.0%" alt="Screenshot of a chatbot filling the page."></a></p>
<figcaption>Screenshot of a chatbot filling the page.</figcaption>
</figure>
</div>
</section>
<section id="sidebar" class="level3">
<h3 class="anchored" data-anchor-id="sidebar">Sidebar</h3>
<p>To have the chat fill a sidebar, set <code>height</code> to <code>100%</code> on both the sidebar and chat.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="genai-chatbots.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> ui</span>
<span id="cb19-2"><a href="genai-chatbots.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="genai-chatbots.html#cb19-3" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb19-4"><a href="genai-chatbots.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="genai-chatbots.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ui.sidebar(width<span class="op">=</span><span class="dv">300</span>, style<span class="op">=</span><span class="st">"height:100%"</span>):</span>
<span id="cb19-6"><a href="genai-chatbots.html#cb19-6" aria-hidden="true" tabindex="-1"></a>    chat.ui(height<span class="op">=</span><span class="st">"100%"</span>, messages<span class="op">=</span>[<span class="st">"Welcome!"</span>])</span>
<span id="cb19-7"><a href="genai-chatbots.html#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="genai-chatbots.html#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">"Main content"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="genai-chatbots.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> ui, App</span>
<span id="cb20-2"><a href="genai-chatbots.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="genai-chatbots.html#cb20-3" aria-hidden="true" tabindex="-1"></a>app_ui <span class="op">=</span> ui.page_sidebar(</span>
<span id="cb20-4"><a href="genai-chatbots.html#cb20-4" aria-hidden="true" tabindex="-1"></a>    ui.sidebar(</span>
<span id="cb20-5"><a href="genai-chatbots.html#cb20-5" aria-hidden="true" tabindex="-1"></a>        ui.chat_ui(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>, messages<span class="op">=</span>[<span class="st">"Welcome!"</span>], height<span class="op">=</span><span class="st">"100%"</span>),</span>
<span id="cb20-6"><a href="genai-chatbots.html#cb20-6" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">300</span>, style<span class="op">=</span><span class="st">"height:100%"</span></span>
<span id="cb20-7"><a href="genai-chatbots.html#cb20-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb20-8"><a href="genai-chatbots.html#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Main content"</span>,</span>
<span id="cb20-9"><a href="genai-chatbots.html#cb20-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-10"><a href="genai-chatbots.html#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="genai-chatbots.html#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> server(<span class="bu">input</span>):</span>
<span id="cb20-12"><a href="genai-chatbots.html#cb20-12" aria-hidden="true" tabindex="-1"></a>    chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb20-13"><a href="genai-chatbots.html#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="genai-chatbots.html#cb20-14" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> App(app_ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/chat-fill-sidebar.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Screenshot of a chatbot filling a sidebar."><img src="../images/chat-fill-sidebar.png" class="rounded shadow d-block m-auto img-fluid figure-img" style="width:67.0%" alt="Screenshot of a chatbot filling a sidebar."></a></p>
<figcaption>Screenshot of a chatbot filling a sidebar.</figcaption>
</figure>
</div>
</section>
<section id="card-layout" class="level3">
<h3 class="anchored" data-anchor-id="card-layout">Card layout</h3>
<p>Another useful UI pattern is to embed the chat component inside a <code>ui.card()</code>. If nothing else, this will help visually separate the chat from the rest of the app. It also provides a natural place to provide a header (with perhaps a <a href="../components/display-messages/tooltips/index.html">tooltip</a> with more info about your chatbot). <a href="../layouts/panels-cards/index.html#content-divided-by-cards">Cards</a> also come with other handy features like <code>full_screen=True</code> to make the chat full-screen when embedded inside a larger app.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="genai-chatbots.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> ui</span>
<span id="cb21-2"><a href="genai-chatbots.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> faicons <span class="im">import</span> icon_svg</span>
<span id="cb21-3"><a href="genai-chatbots.html#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="genai-chatbots.html#cb21-4" aria-hidden="true" tabindex="-1"></a>ui.page_opts(</span>
<span id="cb21-5"><a href="genai-chatbots.html#cb21-5" aria-hidden="true" tabindex="-1"></a>    fillable<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-6"><a href="genai-chatbots.html#cb21-6" aria-hidden="true" tabindex="-1"></a>    fillable_mobile<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-7"><a href="genai-chatbots.html#cb21-7" aria-hidden="true" tabindex="-1"></a>    class_<span class="op">=</span><span class="st">"bg-light"</span>,</span>
<span id="cb21-8"><a href="genai-chatbots.html#cb21-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-9"><a href="genai-chatbots.html#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="genai-chatbots.html#cb21-10" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb21-11"><a href="genai-chatbots.html#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="genai-chatbots.html#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ui.card():</span>
<span id="cb21-13"><a href="genai-chatbots.html#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> ui.card_header(class_<span class="op">=</span><span class="st">"d-flex justify-content-between align-items-center"</span>):</span>
<span id="cb21-14"><a href="genai-chatbots.html#cb21-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Welcome to Posit chat"</span></span>
<span id="cb21-15"><a href="genai-chatbots.html#cb21-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> ui.tooltip():</span>
<span id="cb21-16"><a href="genai-chatbots.html#cb21-16" aria-hidden="true" tabindex="-1"></a>            icon_svg(<span class="st">"question"</span>)</span>
<span id="cb21-17"><a href="genai-chatbots.html#cb21-17" aria-hidden="true" tabindex="-1"></a>            <span class="co">"This chat is brought to you by Posit."</span></span>
<span id="cb21-18"><a href="genai-chatbots.html#cb21-18" aria-hidden="true" tabindex="-1"></a>    chat.ui(</span>
<span id="cb21-19"><a href="genai-chatbots.html#cb21-19" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>[<span class="st">"Hello! How can I help you today?"</span>]</span>
<span id="cb21-20"><a href="genai-chatbots.html#cb21-20" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="genai-chatbots.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> ui, App</span>
<span id="cb22-2"><a href="genai-chatbots.html#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="genai-chatbots.html#cb22-3" aria-hidden="true" tabindex="-1"></a>app_ui <span class="op">=</span> ui.page_fillable(</span>
<span id="cb22-4"><a href="genai-chatbots.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  ui.card(</span>
<span id="cb22-5"><a href="genai-chatbots.html#cb22-5" aria-hidden="true" tabindex="-1"></a>      ui.card_header(</span>
<span id="cb22-6"><a href="genai-chatbots.html#cb22-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Welcome to Posit chat"</span>,</span>
<span id="cb22-7"><a href="genai-chatbots.html#cb22-7" aria-hidden="true" tabindex="-1"></a>          ui.tooltip(</span>
<span id="cb22-8"><a href="genai-chatbots.html#cb22-8" aria-hidden="true" tabindex="-1"></a>              icon_svg(<span class="st">"question"</span>),</span>
<span id="cb22-9"><a href="genai-chatbots.html#cb22-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"This chat is brought to you by Posit."</span></span>
<span id="cb22-10"><a href="genai-chatbots.html#cb22-10" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb22-11"><a href="genai-chatbots.html#cb22-11" aria-hidden="true" tabindex="-1"></a>          class_<span class="op">=</span><span class="st">"d-flex justify-content-between align-items-center"</span></span>
<span id="cb22-12"><a href="genai-chatbots.html#cb22-12" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb22-13"><a href="genai-chatbots.html#cb22-13" aria-hidden="true" tabindex="-1"></a>      ui.chat_ui(</span>
<span id="cb22-14"><a href="genai-chatbots.html#cb22-14" aria-hidden="true" tabindex="-1"></a>          <span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>,</span>
<span id="cb22-15"><a href="genai-chatbots.html#cb22-15" aria-hidden="true" tabindex="-1"></a>          messages<span class="op">=</span>[<span class="st">"Hello! How can I help you today?"</span>],</span>
<span id="cb22-16"><a href="genai-chatbots.html#cb22-16" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb22-17"><a href="genai-chatbots.html#cb22-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb22-18"><a href="genai-chatbots.html#cb22-18" aria-hidden="true" tabindex="-1"></a>    fillable_mobile<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-19"><a href="genai-chatbots.html#cb22-19" aria-hidden="true" tabindex="-1"></a>    class_<span class="op">=</span><span class="st">"bg-light"</span>,</span>
<span id="cb22-20"><a href="genai-chatbots.html#cb22-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-21"><a href="genai-chatbots.html#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="genai-chatbots.html#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> server(<span class="bu">input</span>):</span>
<span id="cb22-23"><a href="genai-chatbots.html#cb22-23" aria-hidden="true" tabindex="-1"></a>    chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb22-24"><a href="genai-chatbots.html#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="genai-chatbots.html#cb22-25" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> App(app_ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/chat-card-tooltip.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Screenshot of a chatbot embedded in a card with a header and tooltip."><img src="../images/chat-card-tooltip.png" class="rounded shadow d-block m-auto img-fluid figure-img" style="width:67.0%" alt="Screenshot of a chatbot embedded in a card with a header and tooltip."></a></p>
<figcaption>Screenshot of a chatbot embedded in a card with a header and tooltip.</figcaption>
</figure>
</div>
</section>
</section>
<section id="theming" class="level2">
<h2 class="anchored" data-anchor-id="theming">Theming</h2>
<section id="custom-css" class="level3">
<h3 class="anchored" data-anchor-id="custom-css">Custom CSS</h3>
<p>To customize main colors and fonts, provide a <code>ui.Theme()</code> to the <code>theme</code> page option. Theming customization may be done directly on <code>ui.Theme()</code> (e.g., <code>.add_defaults()</code>) and/or created from a <a href="https://posit-dev.github.io/brand-yml/">brand-yml</a> file and applied with <code>ui.Theme().from_brand()</code>. Note you can also introduce a dark mode toggle with <code>ui.input_dark_mode()</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="genai-chatbots.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> ui</span>
<span id="cb23-2"><a href="genai-chatbots.html#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="genai-chatbots.html#cb23-3" aria-hidden="true" tabindex="-1"></a>ui.page_opts(</span>
<span id="cb23-4"><a href="genai-chatbots.html#cb23-4" aria-hidden="true" tabindex="-1"></a>    theme<span class="op">=</span>ui.Theme().add_defaults(primary<span class="op">=</span><span class="st">"#a855f7"</span>),</span>
<span id="cb23-5"><a href="genai-chatbots.html#cb23-5" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span>ui.div(</span>
<span id="cb23-6"><a href="genai-chatbots.html#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"My themed chat app"</span>,</span>
<span id="cb23-7"><a href="genai-chatbots.html#cb23-7" aria-hidden="true" tabindex="-1"></a>        ui.input_dark_mode(mode<span class="op">=</span><span class="st">"dark"</span>),</span>
<span id="cb23-8"><a href="genai-chatbots.html#cb23-8" aria-hidden="true" tabindex="-1"></a>        class_<span class="op">=</span><span class="st">"d-flex justify-content-between w-100"</span>,</span>
<span id="cb23-9"><a href="genai-chatbots.html#cb23-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-10"><a href="genai-chatbots.html#cb23-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-11"><a href="genai-chatbots.html#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="genai-chatbots.html#cb23-12" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb23-13"><a href="genai-chatbots.html#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="genai-chatbots.html#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ui.sidebar(width<span class="op">=</span><span class="dv">300</span>, style<span class="op">=</span><span class="st">"height:100%"</span>):</span>
<span id="cb23-15"><a href="genai-chatbots.html#cb23-15" aria-hidden="true" tabindex="-1"></a>    chat.ui(height<span class="op">=</span><span class="st">"100%"</span>, messages<span class="op">=</span>[<span class="st">"Welcome!"</span>])</span>
<span id="cb23-16"><a href="genai-chatbots.html#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="genai-chatbots.html#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">"Main content region"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="genai-chatbots.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> ui, App</span>
<span id="cb24-2"><a href="genai-chatbots.html#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="genai-chatbots.html#cb24-3" aria-hidden="true" tabindex="-1"></a>app_ui <span class="op">=</span> ui.page_sidebar(</span>
<span id="cb24-4"><a href="genai-chatbots.html#cb24-4" aria-hidden="true" tabindex="-1"></a>    ui.sidebar(</span>
<span id="cb24-5"><a href="genai-chatbots.html#cb24-5" aria-hidden="true" tabindex="-1"></a>        ui.chat_ui(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>, messages<span class="op">=</span>[<span class="st">"Welcome!"</span>], height<span class="op">=</span><span class="st">"100%"</span>),</span>
<span id="cb24-6"><a href="genai-chatbots.html#cb24-6" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">300</span>, style<span class="op">=</span><span class="st">"height:100%"</span></span>
<span id="cb24-7"><a href="genai-chatbots.html#cb24-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-8"><a href="genai-chatbots.html#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Main content region"</span>,</span>
<span id="cb24-9"><a href="genai-chatbots.html#cb24-9" aria-hidden="true" tabindex="-1"></a>    theme<span class="op">=</span>ui.Theme().add_defaults(primary<span class="op">=</span><span class="st">"#a855f7"</span>),  <span class="co"># &lt;&lt;</span></span>
<span id="cb24-10"><a href="genai-chatbots.html#cb24-10" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span>ui.tags.div(</span>
<span id="cb24-11"><a href="genai-chatbots.html#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"My themed chat app"</span>,</span>
<span id="cb24-12"><a href="genai-chatbots.html#cb24-12" aria-hidden="true" tabindex="-1"></a>        ui.input_dark_mode(mode<span class="op">=</span><span class="st">"dark"</span>),</span>
<span id="cb24-13"><a href="genai-chatbots.html#cb24-13" aria-hidden="true" tabindex="-1"></a>        class_<span class="op">=</span><span class="st">"d-flex justify-content-between w-100"</span>,</span>
<span id="cb24-14"><a href="genai-chatbots.html#cb24-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-15"><a href="genai-chatbots.html#cb24-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-16"><a href="genai-chatbots.html#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="genai-chatbots.html#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> server(<span class="bu">input</span>):</span>
<span id="cb24-18"><a href="genai-chatbots.html#cb24-18" aria-hidden="true" tabindex="-1"></a>    chat <span class="op">=</span> ui.Chat(<span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>)</span>
<span id="cb24-19"><a href="genai-chatbots.html#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="genai-chatbots.html#cb24-20" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> App(app_ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/chat-themed.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Screenshot of a chatbot with a custom theme and dark mode toggle."><img src="../images/chat-themed.png" class="rounded shadow d-block m-auto img-fluid figure-img" style="width:67.0%" alt="Screenshot of a chatbot with a custom theme and dark mode toggle."></a></p>
<figcaption>Screenshot of a chatbot with a custom theme and dark mode toggle.</figcaption>
</figure>
</div>
</section>
<section id="custom-icons" class="level3">
<h3 class="anchored" data-anchor-id="custom-icons">Custom icons</h3>
<p>Customize the assistant icon by supplying HTML/SVG to <code>icon_assistant</code> when creating the UI element (or when appending a message). The <code>faicons</code> package makes it easy to do this for <a href="https://fontawesome.com/">font awesome</a>, but other icon libraries (e.g., <a href="https://shiny.posit.co/py/docs/(https://icons.getbootstrap.com/#usage)">Bootstrap icons</a>, <a href="https://heroicons.com/">heroicons</a>, etc.) or custom SVGs are also possible by providing inline SVGs as a string to <code>ui.HTML()</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="genai-chatbots.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> faicons <span class="im">import</span> icon_svg</span>
<span id="cb25-2"><a href="genai-chatbots.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="genai-chatbots.html#cb25-3" aria-hidden="true" tabindex="-1"></a>chat.ui(</span>
<span id="cb25-4"><a href="genai-chatbots.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[<span class="st">"**Hello!** How can I help you today?"</span>],</span>
<span id="cb25-5"><a href="genai-chatbots.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  icon_assistant<span class="op">=</span>icon_svg(<span class="st">"slack"</span>),</span>
<span id="cb25-6"><a href="genai-chatbots.html#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="genai-chatbots.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> faicons <span class="im">import</span> icon_svg</span>
<span id="cb26-2"><a href="genai-chatbots.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="genai-chatbots.html#cb26-3" aria-hidden="true" tabindex="-1"></a>ui.chat_ui(</span>
<span id="cb26-4"><a href="genai-chatbots.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>,</span>
<span id="cb26-5"><a href="genai-chatbots.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[<span class="st">"**Hello!** How can I help you today?"</span>],</span>
<span id="cb26-6"><a href="genai-chatbots.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  icon_assistant<span class="op">=</span>icon_svg(<span class="st">"slack"</span>),</span>
<span id="cb26-7"><a href="genai-chatbots.html#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/chat-hello-slack.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Screenshot of a chatbot with a custom (slack) icon."><img src="../images/chat-hello-slack.png" class="rounded shadow d-block m-auto img-fluid figure-img" style="width:67.0%" alt="Screenshot of a chatbot with a custom (slack) icon."></a></p>
<figcaption>Screenshot of a chatbot with a custom (slack) icon.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Custom <code>&lt;img&gt;</code> icons
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>HTML <code>&lt;img&gt;</code> tags also work. By default, they fill their container, and may get clipped by the container‚Äôs <code>border-radius</code>. To scale down the image, add a <code>icon</code> CSS class, or <code>border-0</code> to remove the <code>border</code> and <code>border-radius</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="genai-chatbots.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> faicons <span class="im">import</span> icon_svg</span>
<span id="cb27-2"><a href="genai-chatbots.html#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="genai-chatbots.html#cb27-3" aria-hidden="true" tabindex="-1"></a>chat.ui(</span>
<span id="cb27-4"><a href="genai-chatbots.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[<span class="st">"**Hello!** How can I help you today?"</span>],</span>
<span id="cb27-5"><a href="genai-chatbots.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  icon_assistant<span class="op">=</span>ui.img(</span>
<span id="cb27-6"><a href="genai-chatbots.html#cb27-6" aria-hidden="true" tabindex="-1"></a>    src<span class="op">=</span><span class="st">"https://raw.githubusercontent.com/posit-dev/py-shiny/c1445b2/tests/playwright/shiny/components/chat/icon/img/shiny.png"</span></span>
<span id="cb27-7"><a href="genai-chatbots.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-8"><a href="genai-chatbots.html#cb27-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="genai-chatbots.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> faicons <span class="im">import</span> icon_svg</span>
<span id="cb28-2"><a href="genai-chatbots.html#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="genai-chatbots.html#cb28-3" aria-hidden="true" tabindex="-1"></a>ui.chat_ui(</span>
<span id="cb28-4"><a href="genai-chatbots.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">id</span><span class="op">=</span><span class="st">"chat"</span>,</span>
<span id="cb28-5"><a href="genai-chatbots.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[<span class="st">"**Hello!** How can I help you today?"</span>],</span>
<span id="cb28-6"><a href="genai-chatbots.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  icon_assistant<span class="op">=</span>ui.img(</span>
<span id="cb28-7"><a href="genai-chatbots.html#cb28-7" aria-hidden="true" tabindex="-1"></a>    src<span class="op">=</span><span class="st">"https://raw.githubusercontent.com/posit-dev/py-shiny/c1445b2/tests/playwright/shiny/components/chat/icon/img/shiny.png"</span>,</span>
<span id="cb28-8"><a href="genai-chatbots.html#cb28-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-9"><a href="genai-chatbots.html#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/chat-hello-shiny.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Screenshot of a chatbot with a custom (shiny) image icon."><img src="../images/chat-hello-shiny.png" class="rounded shadow d-block m-auto img-fluid figure-img" style="width:67.0%" alt="Screenshot of a chatbot with a custom (shiny) image icon."></a></p>
<figcaption>Screenshot of a chatbot with a custom (shiny) image icon.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="recommend-input" class="level2">
<h2 class="anchored" data-anchor-id="recommend-input">Recommend input</h2>
<section id="suggest-input" class="level3">
<h3 class="anchored" data-anchor-id="suggest-input">Suggest input</h3>
<p>Help users start or continue a conversation by providing <strong>input suggestions</strong>. To create one, add a <code>suggestion</code> CSS class to relevant portion(s) of the message text. You can also add a <code>submit</code> class to make the suggestion submit the input automatically. Try clicking on the suggestions (or accessing via keyboard) below to see how they work.</p>
<div class="mobile-layout">
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
#| layout: vertical
#| viewerHeight: 300

from shiny.express import ui

welcome = """
**Hello!** How can I help you today?

Here are a couple suggestions:

* &lt;span class="suggestion"&gt;Tell me a joke&lt;/span&gt;
* &lt;span class="suggestion submit"&gt;Tell me a story&lt;/span&gt;
"""

chat = ui.Chat(id="chat")
chat.ui(messages=[welcome])

@chat.on_user_submit
async def _(user_input: str):
    await chat.append_message(f"You said: {user_input}")</code></pre>
</div>
<p>Suggestions are a great way to help guide users throughout a multi-turn conversation (for real examples, see <a href="genai-inspiration.html#guided-exploration-üß≠">here</a>). To accomplish this, you‚Äôll need to instruct the AI how to generate suggestions itself. We‚Äôve found that adding a section like the one below to your <a href="genai-chatbots.html#models-prompts"><code>system_prompt</code></a> to be effective for this:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="genai-chatbots.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">## Showing prompt suggestions</span></span>
<span id="cb30-2"><a href="genai-chatbots.html#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="genai-chatbots.html#cb30-3" aria-hidden="true" tabindex="-1"></a>If you find it appropriate to suggest prompts the user might want to write, wrap the text of each prompt in <span class="in">`&lt;span class="suggestion"&gt;`</span> tags.</span>
<span id="cb30-4"><a href="genai-chatbots.html#cb30-4" aria-hidden="true" tabindex="-1"></a>Also use "Suggested next steps:" to introduce the suggestions. For example:</span>
<span id="cb30-5"><a href="genai-chatbots.html#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="genai-chatbots.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-7"><a href="genai-chatbots.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="in">Suggested next steps:</span></span>
<span id="cb30-8"><a href="genai-chatbots.html#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="genai-chatbots.html#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="in">1. &lt;span class="suggestion"&gt;Suggestion 1.&lt;/span&gt;</span></span>
<span id="cb30-10"><a href="genai-chatbots.html#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="in">2. &lt;span class="suggestion"&gt;Suggestion 2.&lt;/span&gt;</span></span>
<span id="cb30-11"><a href="genai-chatbots.html#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="in">3. &lt;span class="suggestion"&gt;Suggestion 3.&lt;/span&gt;</span></span>
<span id="cb30-12"><a href="genai-chatbots.html#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Card-based suggestions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Input suggestions can also things other than text, like images or cards. To create one, supply a <code>data-suggestion</code> attribute with the suggestion text on the desired HTML element. As shown below, we highly recommend using a <code>ui.card()</code> in this scenario ‚Äì it should be fairly obvious to the user that it‚Äôs clickable, and comes with a nice hover effect.</p>
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
#| layout: vertical
#| viewerHeight: 400
#| editorHeight: 300

## file: app.py
from shiny import reactive
from shiny.express import expressify, ui
from suggestions import card_suggestions

with ui.hold() as suggestions:
    card_suggestions()

welcome = f"""
**Hello!** How can I help you today?

Here are a couple suggestions:

{suggestions[0]}
"""

chat = ui.Chat(id="chat")
chat.ui(messages=[welcome])

@chat.on_user_submit
async def _(user_input: str):
    await chat.append_message(f"You said: {user_input}")

## file: suggestions.py
from shiny.express import expressify, ui

@expressify
def card_suggestion(title: str, suggestion: str, img_src: str, img_alt: str):
    with ui.card(data_suggestion=suggestion):
        ui.card_header(title)
        ui.fill.as_fill_item(
            ui.img(
                src=img_src,
                alt=img_alt,
            )
        )

@expressify
def card_suggestions():
    with ui.layout_column_wrap(height=200):
        card_suggestion(
            title="Learn Python",
            suggestion="Teach me Python",
            img_src="https://upload.wikimedia.org/wikipedia/commons/c/c3/Python-logo-notext.svg",
            img_alt="Python logo",
        )
        card_suggestion(
            title="Learn R",
            suggestion="Teach me R",
            img_src="https://upload.wikimedia.org/wikipedia/commons/1/1b/R_logo.svg",
            img_alt="R logo",
        )</code></pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Keyboard shortcuts
</div>
</div>
<div class="callout-body-container callout-body">
<p>Any suggestion can be auto-submitted by holding <code>Ctrl/Cmd</code> when clicking on it. Morever, you can opt-out of auto-submitting any suggestion by holding <code>Alt/Option</code> when clicking on a suggestion.</p>
</div>
</div>
</section>
<section id="update-input" class="level3">
<h3 class="anchored" data-anchor-id="update-input">Update input</h3>
<p>Input suggestions are a great starting point for recommending input to user, but more advanced use cases may require programmatically updating the user input. With <code>chat.update_user_input()</code>, you can change placeholder text, the input value, and even focus or submit that value on the user‚Äôs behalf.</p>
<p>For example, the app below collects some user input through a set of inputs in the sidebar, which effectively just prepopulates the starting user prompt, which the user can then further modify as they see fit:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-update-input.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Screenshot of an app using input controls to populate a user prompt"><img src="../images/genai-update-input.png" class="rounded shadow mt-3 img-fluid figure-img" alt="Screenshot of an app using input controls to populate a user prompt"></a></p>
<figcaption>Screenshot of an app using input controls to populate a user prompt</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The app above is available as a <a href="../templates/index.html">template</a>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="genai-chatbots.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> data-sci-adventure <span class="dt">\</span></span>
<span id="cb32-2"><a href="genai-chatbots.html#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">--github</span> posit-dev/py-shiny-templates/gen-ai</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="interactive-messages" class="level2">
<h2 class="anchored" data-anchor-id="interactive-messages">Interactive messages</h2>
<p>Messages can contain Shiny UI elements like <a href="../components/index.html#inputs">inputs</a>, <a href="../components/index.html#outputs">outputs</a>, etc. This allows you to collect user input, display rich interactive output (e.g., <a href="jupyter-widgets.html">Jupyter Widgets</a>), or provide additional context (e.g.&nbsp;<a href="../components/display-messages/tooltips/index.html">tooltips</a>) from within the chat.</p>
<p>For example, in the ‚ÄúWhat‚Äôs for Dinner?‚Äù app, when the user requests to extract recipe, a message is shown with a human readable version of recipe, as well as a <a href="../api/express/express.render.download.html">download button</a> to get the recipe in a structured JSON format:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-interactive-messages.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Screenshot of a download button included in a chat message"><img src="../images/genai-interactive-messages.png" class="rounded shadow mt-3 img-fluid figure-img" alt="Screenshot of a download button included in a chat message"></a></p>
<figcaption>Screenshot of a download button included in a chat message</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The app above is available as a <a href="../templates/index.html">template</a>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="genai-chatbots.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> dinner-recipe <span class="dt">\</span></span>
<span id="cb33-2"><a href="genai-chatbots.html#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">--github</span> posit-dev/py-shiny-templates/gen-ai</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>For a more basic example, here‚Äôs a startup message with an input field:</p>
<div class="mobile-layout">
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
#| layout: vertical
#| viewerHeight: 300
from shiny.express import ui

with ui.hold() as welcome:
    "**Hello!** What's your name?"
    ui.input_text("name", None, placeholder="Enter name here")

chat = ui.Chat(id="chat")
chat.ui(messages=[welcome])</code></pre>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interactive tool displays
</div>
</div>
<div class="callout-body-container callout-body">
<p>Probably the most interesting way in which interactive messages can be used is from a custom <a href="genai-tools.html">tool call</a> display. For example, you could have a tool that displays a <a href="../components/outputs/data-grid.html">Data Grid</a> or <a href="jupyter-widgets.html">Jupyter Widget</a> (e.g., a <a href="../components/outputs/plot-plotly/index.html">plotly</a> graph).</p>
</div>
</div>
</section>
<section id="message-streams" class="level2">
<h2 class="anchored" data-anchor-id="message-streams">Message streams</h2>
<section id="non-blocking-streams" class="level3">
<h3 class="anchored" data-anchor-id="non-blocking-streams">Non-blocking streams</h3>
<p>Under-the-hood, <code>.append_message_stream()</code> launches a non-blocking <a href="nonblocking.html">extended task</a>. This allows the app to be responsive while the AI generates the response, even when multiple concurrent users are on a single Python process.</p>
<p>A few other benefits of an extended task is that they make it easy to:</p>
<ol type="1">
<li>Reactively read for the <code>.result()</code>.</li>
<li>Reactively read for the <code>.status()</code>.</li>
<li><code>.cancel()</code> the stream.</li>
</ol>
<p>To grab the latest message stream, read the <code>.latest_message_stream</code> property on the <code>chat</code> object. This property always points to the most recent message stream, making it easy to work with it in a reactive context. Here‚Äôs an example of reactively reading the status and result of the latest message stream:</p>
<div class="mobile-layout">
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
#| layout: vertical
#| viewerHeight: 350
#| editorHeight: 300

## file: app.py
from app_utils import stream_generator
from shiny.express import render, ui

chat = ui.Chat("chat")

@render.code
def stream_status():
    return f"Status: {chat.latest_message_stream.status()}"

chat.ui(placeholder="Type anything here and press Enter")

@render.text
async def stream_result():
    return f"Result: {chat.latest_message_stream.result()}"

@chat.on_user_submit
async def _(message: str):
    await chat.append_message_stream(stream_generator())

## file: app_utils.py
import asyncio

async def stream_generator():
    for i in range(5):
        await asyncio.sleep(0.5)
        yield f"Message {i} \n\n"</code></pre>
</div>
<p>Providing good UI/UX for canceling a stream is a bit more involved, but it can be done with a button that cancels the stream and notifies the user. See the example below for an approach to this:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stream cancellation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="mobile-layout">
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
#| layout: vertical
#| viewerHeight: 350
#| editorHeight: 300

## file: app.py
from app_utils import stream_generator

from shiny import reactive
from shiny.express import input, ui

ui.input_action_button(
    "cancel",
    "Cancel stream",
    class_="btn btn-danger",
)

chat = ui.Chat("chat")
chat.ui(placeholder="Type anything here and press Enter")

@chat.on_user_submit
async def _(message: str):
    await chat.append_message_stream(stream_generator())

@reactive.effect
@reactive.event(input.cancel)
def _():
    chat.latest_message_stream.cancel()
    ui.notification_show("Stream cancelled", type="warning")

@reactive.effect
def _():
    ui.update_action_button(
        "cancel",
        disabled=chat.latest_message_stream.status() != "running"
    )


## file: app_utils.py
import asyncio

async def stream_generator():
    for i in range(3):
        await asyncio.sleep(0.75)
        yield f"Message {i} \n\n"</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="message-stream-context" class="level3">
<h3 class="anchored" data-anchor-id="message-stream-context">Streaming context</h3>
<p>An alternative way to append a streaming messages is through the <code>.message_stream_context()</code> context manager. Compared to <code>.append_message_stream()</code>, it provides a bit more control over the stream‚Äôs lifecycle and content, but has the downside of not being non-blocking by default. You‚Äôll find it useful when you want to:</p>
<ol type="1">
<li>Overwrite/replace content that already exists in a message.</li>
<li>Insert a new stream inside an existing stream.</li>
</ol>
<p>The example below demonstrates both of these use cases. Note how the inner stream is used to show progress, and the outer stream is used to provide context:</p>
<div class="mobile-layout">
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
#| layout: vertical
#| viewerHeight: 250
#| editorHeight: 300
import asyncio

from shiny import reactive
from shiny.express import input, ui

welcome = f"""
**Hello!** Press the button below to append a stream.

{ui.input_task_button("do_stream", "Stream", class_="btn btn-primary")}
"""

chat = ui.Chat(id="my_chat")
chat.ui(messages=[welcome])

@reactive.effect
@reactive.event(input.do_stream)
async def _():
    async with chat.message_stream_context() as outer:
        await outer.append("Starting stream üîÑ...\n\nProgress:")
        async with chat.message_stream_context() as inner:
            for x in [0, 50, 100]:
                await inner.replace(f" {x}%")
                await asyncio.sleep(1)
        await outer.replace("Completed stream ‚úÖ")</code></pre>
</div>
<p>As you‚Äôll learn in <a href="genai-tools.html">tool calling</a>, a <code>.message_stream()</code> can also be nested inside an non-blocking <code>.append_message_stream()</code>, which is primarily useful for showing tool progress/results.</p>
</section>
</section>
<section id="troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting">Troubleshooting</h2>
<section id="error-handling" class="level3">
<h3 class="anchored" data-anchor-id="error-handling">Error handling</h3>
<p>When an error occurs in the <code>@chat.on_user_submit</code> callback, the app displays a dismissible notification about the error. When running locally, the actual error message is shown, but in production, only a generic message is shown (i.e., the error is sanitized since it may contain sensitive information). If you‚Äôd prefer to have errors stop the app, that can also be done through the <code>on_error</code> argument of <code>Chat</code> (see <a href="../api/ui.Chat.html">the documentation</a> for more information).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/chat-error.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Screenshot of a chatbot with an error message."><img src="../images/chat-error.png" class="rounded shadow mb-5 d-block m-auto img-fluid figure-img" style="width:67.0%" alt="Screenshot of a chatbot with an error message."></a></p>
<figcaption>Screenshot of a chatbot with an error message.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Custom error messages
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Another way to handle error is to catch them yourself and append a message to the chat. This way, you can might provide a better experience with ‚Äúknown‚Äù errors, like when the user enters an invalid/unexpected input:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="genai-chatbots.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> format_as_error(x: <span class="bu">str</span>):</span>
<span id="cb38-2"><a href="genai-chatbots.html#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f'&lt;span class="text-danger"&gt;</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">&lt;/span&gt;'</span></span>
<span id="cb38-3"><a href="genai-chatbots.html#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="genai-chatbots.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="at">@chat.on_user_submit</span></span>
<span id="cb38-5"><a href="genai-chatbots.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> _(user_input: <span class="bu">str</span>):</span>
<span id="cb38-6"><a href="genai-chatbots.html#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> user_input.startswith(<span class="st">"http"</span>):</span>
<span id="cb38-7"><a href="genai-chatbots.html#cb38-7" aria-hidden="true" tabindex="-1"></a>        msg <span class="op">=</span> format_as_error(<span class="st">"Please enter a valid URL"</span>)</span>
<span id="cb38-8"><a href="genai-chatbots.html#cb38-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cf">await</span> chat.append_message(msg)</span>
<span id="cb38-9"><a href="genai-chatbots.html#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="genai-chatbots.html#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb38-11"><a href="genai-chatbots.html#cb38-11" aria-hidden="true" tabindex="-1"></a>        contents <span class="op">=</span> scrape_page_with_url(<span class="bu">input</span>)</span>
<span id="cb38-12"><a href="genai-chatbots.html#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb38-13"><a href="genai-chatbots.html#cb38-13" aria-hidden="true" tabindex="-1"></a>        msg <span class="op">=</span> <span class="st">"I'm sorry, I couldn't extract content from that URL. Please try again."</span></span>
<span id="cb38-14"><a href="genai-chatbots.html#cb38-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cf">await</span> chat.append_message(format_as_error(msg))</span>
<span id="cb38-15"><a href="genai-chatbots.html#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="genai-chatbots.html#cb38-16" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="cf">await</span> chat_client.stream_async(contents)</span>
<span id="cb38-17"><a href="genai-chatbots.html#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> chat.append_message_stream(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="debugging" class="level3">
<h3 class="anchored" data-anchor-id="debugging">Debugging</h3>
<p>Sometimes response generation from an LLM might not be quite what you expect, leaving you to wonder what went wrong. With <code>chatlas</code>, your primary interactive debugging tool is to set <code>echo="all"</code> in the <code>.stream_async()</code> method to see the context of the chat history (emitted to your Python console). For lower-level debugging, you can also enable logging and/or access the full chat history via the <code>chat_client.get_turns()</code> method. For more, see <code>chatlas</code>‚Äô <a href="https://posit-dev.github.io/chatlas/#troubleshooting">troubleshooting guide</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Monitoring in production
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since <code>chatlas</code> builds on top of official Python SDKs like <code>openai</code> and <code>anthropic</code>, <a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/monitor-openai">monitoring</a> solutions that integrate with their <a href="https://github.com/openai/openai-python?tab=readme-ov-file#logging">logging</a> mechanism can be used to monitor and debug your chatbot in production.</p>
</div>
</div>
</section>
</section>
<section id="message-history" class="level2">
<h2 class="anchored" data-anchor-id="message-history">Message history</h2>
<p>The <code>chat.messages()</code> method returns a tuple of all the messages appended after startup. Use this if you want to obtain a record of messages as they appear in the UI. This makes implementing something like download feature easy:</p>
<div class="mobile-layout">
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
#| layout: vertical
#| viewerHeight: 375
import json
from shiny.express import render, ui

ui.page_opts(fillable=True, fillable_mobile=True)

chat = ui.Chat("chat")

chat.ui(messages=["Welcome!"])

@render.download(filename="messages.json", label="Download messages")
def download():
    yield json.dumps(chat.messages())

@chat.on_user_submit
async def _(user_input: str):
    await chat.append_message(f"You said: {user_input}")</code></pre>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Front-end vs back-end
</div>
</div>
<div class="callout-body-container callout-body">
<p>Beware that <code>chat.messages()</code> only returns only the content sent to the UI, not necessarily the full message content sent/returned by the LLM. This means, if your chat history contains ‚Äúbackground‚Äù context, you may instead want that full back-end message history. Note that with <code>chatlas</code>, you can access and set that additional context via the <code>.get_turns()</code> and <code>.set_turns()</code> methods on the <code>chat_client</code>.</p>
</div>
</div>
<p>For a more advanced example of how you can combine reactivity with <code>chat.messages()</code> to add a ‚ÄúNew chat‚Äù button with a dropdown to select previous chats, see the example below:</p>
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
#| layout: vertical
#| viewerHeight: 400
#| editorHeight: 400

from datetime import datetime
from faicons import icon_svg
from shiny import reactive
from shiny.express import input, render, ui

ui.page_opts(fillable=True, fillable_mobile=True)

chat = ui.Chat(id="chat")
chat.ui(messages=["**Hello!** How can I help you today?"])

with ui.layout_columns(fill=False):
    ui.input_action_button("new", "New chat", icon=icon_svg("plus"))

    @render.express
    def history_ui():
        if not history():
            return
        choices = list(history().keys())
        choices_dict = dict(zip(choices, choices))
        ui.input_select(
            "previous_chat", None,
            choices={"": "Choose a previous chat", **choices_dict}
        )


@chat.on_user_submit
async def _(user_input: str):
    await chat.append_message(f"You said: {user_input}")

# Track chat history
history = reactive.value({})

# When a new chat is started, add the current chat messages
# to the history, clear the chat, and append a new start message
@reactive.effect
@reactive.event(input.new)
async def _():
    stamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    hist = {**history(), stamp: chat.messages()}
    history.set(hist)
    await chat.clear_messages()
    await chat.append_message(f"Chat started at {stamp}")

# When a previous chat is selected, clear the current chat,
# and append the messages from the selected chat
@reactive.effect
@reactive.event(input.previous_chat)
async def _():
    if not input.previous_chat():
        return
    msgs = history()[input.previous_chat()]
    await chat.clear_messages()
    for msg in msgs:
        await chat.append_message(msg)</code></pre>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>The <a href="genai-stream.html">next article</a> covers a more generic way to stream generative AI: the <code>ui.MarkdownStream()</code> component. This component is useful when you don‚Äôt want a full chat interface, but still want to stream in some content from an LLM.</p>
<p>Skip to other articles in the series if you want to learn about other generally useful Generative AI techniques like <a href="genai-tools.html">tool calls</a>, <a href="genai-structured-data.html">structured output</a>, and <a href="genai-rag.html">RAG</a>.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This can be especially frustrating behavior since hosted apps, by default, will close a idle session after a certain (<a href="https://docs.posit.co/shinyapps.io/guide/applications/#advanced-settings">configurable</a>) amount of time.<a href="genai-chatbots.html#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>When server-side state can‚Äôt be fully determined by the UI‚Äôs <code>input</code> values alone, you‚Äôll need to register <code>on_bookmark</code> and <code>on_restore</code> callbacks to save and restore that server-state.<a href="genai-chatbots.html#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="genai-inspiration.html" class="pagination-link" aria-label="Get inspired">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Get inspired</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="genai-stream.html" class="pagination-link" aria-label="Streaming">
        <span class="nav-page-text">Streaming</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Proudly supported by <a href="https://www.posit.co/" class="no-icon"><img src="../images/posit-logo-black.svg" alt="Posit" width="80" style="padding-left: 3px;vertical-align:text-top;"></a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/posit-dev/py-shiny-site/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/posit-dev/py-shiny-site/edit/main/docs/genai-chatbots.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://discord.gg/yMGCamUMnS">
      <i class="bi bi-discord" role="img" aria-label="Shiny Discord">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/posit-dev/py-shiny/">
      <i class="bi bi-github" role="img" aria-label="Shiny for Python Github">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/posit_pbc">
      <i class="bi bi-twitter" role="img" aria-label="Posit Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/playlist?list=PL9HYL-VRX0oRbLoj3FyL5zeASU5FMDgVe">
      <i class="bi bi-youtube" role="img" aria-label="Shiny YouTube Playlist">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"fade","descPosition":"bottom","loop":false,"openEffect":"fade","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>