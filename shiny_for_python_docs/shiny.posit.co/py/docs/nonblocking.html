<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Non-blocking operations – Shiny for Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="routing.html" rel="next">
<link href="comp-r-shiny.html" rel="prev">
<link href="../favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-888ef42a095209a13a17dbfda2cb877d.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-06a6b8726800c70458725a52052b40c7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content="..">
<script src="../site_libs/quarto-contrib/shinylive-0.10.4/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="../site_libs/quarto-contrib/shinylive-0.10.4/shinylive/run-python-blocks.js" type="module"></script>
<link href="../site_libs/quarto-contrib/shinylive-0.10.4/shinylive/shinylive.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
  // Redirect URLs like https://shiny.posit.co/py to
  // https://shiny.posit.co/py/ (with trailing slash). This is needed for
  // relative paths to work correctly. Unfortunately, Netlify cannot have a
  // redirect that adds or removes a trailing slash.
  if (
    !window.location.pathname.endsWith(".html") &&
    !window.location.pathname.endsWith("/")
  ) {
    window.location.replace(window.location.href + "/");
  }
</script>

<!-- Google Tag Manager -->
<script>
  // prettier-ignore
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KHBDBW7');
</script>
<!-- End Google Tag Manager -->

<!-- Add rel="noopener noreferrer" to each target="_blank" -->
<script type="text/javascript">
  window.addEventListener("load", () =>
    [...document.querySelectorAll("a[target=_blank]")].forEach((lnk) =>
      lnk.setAttribute("rel", "noopener noreferrer")
    )
  );
</script>
<!-- End Add rel="noopener noreferrer" to each target="_blank" -->

<script type="text/javascript">
  (function () {
    function addShinyliveEditLinks() {
      const codeWithLink = document.querySelectorAll(
        ".sourceCode[data-shinylive]"
      );
      codeWithLink.forEach((el) => {
        el.classList.add("code-with-shinylive-link");
        const url = el.dataset.shinylive;

        // <a class="edit-shinylive-button btn btn-link" href="https://shiny.posit.co/py/docs/&lt;%=&#32;app.shinylive&#32;%&gt;" data-bs-toggle="tooltip" data-bs-title="Edit in Shinylive" data-bs-placement="bottom">
        //  <i class="bi bi-lightning-fill"></i> <span class="visually-hidden">Edit in Shinylive</span>
        // </a>

        const link = document.createElement("a");
        link.classList.add("edit-shinylive-button", "btn", "btn-link");
        link.href = url;
        link.dataset.bsToggle = "tooltip";
        link.dataset.bsTitle = "Edit in Shinylive";
        link.dataset.bsPlacement = "bottom";

        const icon = document.createElement("i");
        icon.classList.add("bi", "bi-lightning-fill");
        link.appendChild(icon);

        const span = document.createElement("span");
        span.classList.add("visually-hidden");
        span.innerText = "Edit in Shinylive";
        link.appendChild(span);

        const btnCopy = el.querySelector(".code-copy-button");
        if (btnCopy) {
          btnCopy.parentElement.appendChild(link);
        } else {
          if (el.matches("pre")) {
            el.appendChild(link);
          } else {
            el.querySelector("pre").appendChild(link);
          }
        }

        if (window.bootstrap?.Tooltip) {
          new bootstrap.Tooltip(link);
        }
        el.removeAttribute("data-shinylive");
      });
    }

    function addWhatsShinyExpressTooltip() {
      const tooltipContents = `<p><strong>Shiny Express</strong> is a new, streamlined way to write a Shiny app.</p>
    <p><strong>Shiny Core</strong> refers to the original, functional Shiny syntax, which is still a great way to write Shiny apps.</p>
    <p class="fw-600" style="font-size:0.85em;"><a href="https://shiny.posit.co/blog/posts/shiny-express/">Read more <i class="bi bi-chevron-right align-text-top"></i></a></p>`;

      const tooltipDisplay = `<i class="bi bi-question-circle-fill d-inline d-sm-none"></i><span class="d-none d-sm-inline">What's this?</span>`;

      document
        .querySelectorAll(".panel-tabset.shiny-mode-tabset")
        .forEach(function (tabset) {
          const trigger = document.createElement("div");
          trigger.classList.add("what-shiny-express", "text-white");
          trigger.tabIndex = 0;
          trigger.innerHTML = tooltipDisplay;
          tabset.appendChild(trigger);

          if (!window.bootstrap?.Popover) {
            return;
          }

          new window.bootstrap.Popover(trigger, {
            html: true,
            title: "Express vs Core",
            content: tooltipContents,
            placement: "auto",
            trigger: "focus",
            container: tabset,
          });
        });
    }

    function handlePanelVariants() {
      document.querySelectorAll(".panel-pills > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-pills");
      });
      document.querySelectorAll(".panel-underline > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-underline");
      });
      document.querySelectorAll(".shiny-mode-tabset > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-underline");
      });
    }

    function onLoad() {
      addShinyliveEditLinks();
      addWhatsShinyExpressTooltip();
      handlePanelVariants();
    }

    document.readyState === "loading"
      ? document.addEventListener("DOMContentLoaded", onLoad)
      : onLoad();
  })();
</script>

<!-- <div
  class="alert alert-primary text-center mb-0 border-0"
  style="padding: 0.6rem"
  role="alert"
>
  <p class="d-md-inline my-0 me-md-4 p-90">
    <strong>🎉 Introducing Shiny Express</strong>
  </p>
  <p class="d-md-inline my-0 p-90 me-md-4">
    A simpler way to write and learn Shiny.
  </p>
  <p class="d-md-inline my-0 p-90 me-md-4">
    <a
      href="https://shiny.posit.co/blog/posts/shiny-express/"
      target="_blank"
      style="color: #00314e"
      >Learn more</a
    >.
  </p>
</div> -->


<meta property="og:title" content="Non-blocking operations – Shiny for Python">
<meta property="og:description" content="Build interactive web applications easily with the power of Python’s data and scientific stack.">
<meta property="og:image" content="https://shiny.posit.co/py/images/shiny-for-python.jpg">
<meta property="og:site_name" content="Shiny for Python">
<meta property="og:locale" content="es_ES">
<meta name="twitter:title" content="Shiny for Python">
<meta name="twitter:description" content="Build interactive web applications easily with the power of Python’s data and scientific stack.">
<meta name="twitter:image" content="https://shiny.posit.co/py/images/shiny-for-python.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../shiny-for-python.svg" alt="The logo for Shiny for Python" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Shiny for Python</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../get-started/index.html"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="overview.html" aria-current="page"> 
<span class="menu-text">Concepts</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="nonblocking.html#" id="nav-menu-components" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Components</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-components">    
        <li>
    <a class="dropdown-item" href="../components/index.html"><i class="bi bi-sliders" role="img">
</i> 
 <span class="dropdown-text">Components</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../layouts/index.html"><i class="bi bi-layout-text-window-reverse" role="img">
</i> 
 <span class="dropdown-text">Layouts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../templates/index.html"><i class="bi bi-code-square" role="img">
</i> 
 <span class="dropdown-text">Templates</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../gallery/index.html"> 
<span class="menu-text">Gallery</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://shinylive.io/py/examples/" target="_blank"> 
<span class="menu-text">Playground</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="nonblocking.html#" id="nav-menu-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reference">    
        <li>
    <a class="dropdown-item" href="../api/express/index.html">
 <span class="dropdown-text">Shiny Express</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api/core/index.html">
 <span class="dropdown-text">Shiny Core</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api/testing/index.html">
 <span class="dropdown-text">Testing</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://discord.gg/yMGCamUMnS" title="" class="quarto-navigation-tool px-1" aria-label="Shiny Discord"><i class="bi bi-discord"></i></a>
    <a href="https://github.com/posit-dev/py-shiny/" title="" class="quarto-navigation-tool px-1" aria-label="Shiny for Python Github"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="nonblocking.html"><span class="emoji-icon">🧩</span> <strong>Miscellaneous</strong></a></li><li class="breadcrumb-item"><a href="nonblocking.html">Non-blocking operations</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📌</span> <strong>Essentials</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="user-interfaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">User interfaces</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🤖</span> <strong>Generative AI</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-inspiration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Get inspired</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-chatbots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chatbots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-stream.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Streaming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tool calling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-structured-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structured data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-rag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAG</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🎨</span> <strong>User interfaces</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="jupyter-widgets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jupyter Widgets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-dynamic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic UI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">UI as HTML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-customize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Customizing UI</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">⚡</span> <strong>Reactivity</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-mutable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mutable objects</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📝</span> <strong>Syntax modes</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-vs-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Express vs.&nbsp;Core</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-or-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Choosing a syntax</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-in-depth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Express in depth</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-to-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transition to Core</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📦</span> <strong>Modules</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="modules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shiny Modules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="module-communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Module Communication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🧪</span> <strong>Testing</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="unit-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="end-to-end-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End-to-End Testing Your App</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🏗️</span> <strong>Extending</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="custom-component-one-off.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom JavaScript component</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="custom-components-pkg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom components package</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📊</span> <strong>Comparisons</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="comp-streamlit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Streamlit</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="comp-r-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shiny for R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🧩</span> <strong>Miscellaneous</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="nonblocking.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Non-blocking operations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="routing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Routing</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="nonblocking.html#using-asyncawait-in-shiny" id="toc-using-asyncawait-in-shiny" class="nav-link active" data-scroll-target="#using-asyncawait-in-shiny">Using async/await in Shiny</a>
  <ul class="collapse">
  <li><a href="nonblocking.html#reactive-asyncawait" id="toc-reactive-asyncawait" class="nav-link" data-scroll-target="#reactive-asyncawait">Reactive async/await</a></li>
  <li><a href="nonblocking.html#why-does-async-block" id="toc-why-does-async-block" class="nav-link" data-scroll-target="#why-does-async-block">Why does async block?</a></li>
  </ul></li>
  <li><a href="nonblocking.html#true-non-blocking-behavior-with-extendedtask" id="toc-true-non-blocking-behavior-with-extendedtask" class="nav-link" data-scroll-target="#true-non-blocking-behavior-with-extendedtask">True non-blocking behavior with <code>ExtendedTask</code></a>
  <ul class="collapse">
  <li><a href="nonblocking.html#invoking-the-task" id="toc-invoking-the-task" class="nav-link" data-scroll-target="#invoking-the-task">Invoking the task</a></li>
  <li><a href="nonblocking.html#retrieving-results" id="toc-retrieving-results" class="nav-link" data-scroll-target="#retrieving-results">Retrieving results</a></li>
  <li><a href="nonblocking.html#other-features-of-extended-tasks" id="toc-other-features-of-extended-tasks" class="nav-link" data-scroll-target="#other-features-of-extended-tasks">Other features of extended tasks</a></li>
  <li><a href="nonblocking.html#executing-on-a-different-threadprocess" id="toc-executing-on-a-different-threadprocess" class="nav-link" data-scroll-target="#executing-on-a-different-threadprocess">Executing on a different thread/process</a></li>
  </ul></li>
  <li><a href="nonblocking.html#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/posit-dev/py-shiny-site/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/posit-dev/py-shiny-site/edit/main/docs/nonblocking.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KHBDBW7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="nonblocking.html"><span class="emoji-icon">🧩</span> <strong>Miscellaneous</strong></a></li><li class="breadcrumb-item"><a href="nonblocking.html">Non-blocking operations</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Non-blocking operations</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Sometimes in a Shiny app, you need to perform a long-running operation, like loading a large dataset or doing an expensive computation. If you do this in a reactive context, it will block the rest of the application from running until the operation completes. This can be frustrating for users, who may think that the app has crashed.</p>
<p>Worse, if you have multiple users, then one user’s long-running operation will block the other users’ apps from running as well. These other users will not even be aware that their slow performance is due to another user’s actions.</p>
<p>In this article, we’ll learn how to make Shiny apps more responsive by using non-blocking operations. We’ll also go out of our way to explain why the usual Python async techniques don’t work the same way in Shiny as in other web frameworks.</p>
<section id="using-asyncawait-in-shiny" class="level2">
<h2 class="anchored" data-anchor-id="using-asyncawait-in-shiny">Using async/await in Shiny</h2>
<p>Asynchronous programming is a technique used in many programming languages to increase scalability and responsiveness, usually in programs that do a lot of networking like web servers and clients. Python supports async programming at the language level, using the <code>async</code>/<code>await</code> keywords; in the standard library, with the <a href="https://docs.python.org/3/library/asyncio.html"><code>asyncio</code></a> module; and in third-party libraries, like <a href="https://fastapi.tiangolo.com/">FastAPI</a> and <a href="https://docs.aiohttp.org/">aiohttp</a>.</p>
<p>Shiny has async support as well, but it’s a bit different from your typical async Python framework. On the one hand, Shiny is built on top of <a href="https://www.starlette.io/">Starlette</a>, which is an async web framework, so it’s possible to use async functions in many parts of your Shiny app. On the other hand, Shiny is also designed around reactive programming concepts, and that creates constraints on how async functions can be used.</p>
<section id="reactive-asyncawait" class="level3">
<h3 class="anchored" data-anchor-id="reactive-asyncawait">Reactive async/await</h3>
<p>Shiny supports the use of <code>async</code> and <code>await</code> in your reactive code. You can use <code>async</code> functions in <code>@reactive.effect</code>, <code>@reactive.calc</code>, and render functions, and within those async functions you can use <code>await</code> to wait for the results of other async functions.</p>
<p>However, you may be surprised to learn that this technique alone does not result in improved responsiveness in Shiny apps!</p>
<p>In the app below, the first thing in the UI is a reactive output that displays the current time. Click the button and notice that, during the five seconds that the app is waiting for the (artificially slow) sum calculation to complete, the time does not update.</p>
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
import asyncio
import datetime
from shiny import App, reactive, render, ui

app_ui = ui.page_fluid(
    ui.p("The time is ", ui.output_text("current_time", inline=True)),
    ui.hr(),
    ui.input_numeric("x", "x", value=1),
    ui.input_numeric("y", "y", value=2),
    ui.input_task_button("btn", "Add numbers"),
    ui.output_text("sum"),
)

def server(input, output, session):
    @render.text
    def current_time():
        reactive.invalidate_later(1)
        return datetime.datetime.now().strftime("%H:%M:%S %p")

    @reactive.calc
    @reactive.event(input.btn)
    async def sum_values():
        await asyncio.sleep(5)
        return input.x() + input.y()

    @render.text
    async def sum():
        return str(await sum_values())

app = App(app_ui, server)</code></pre>
<p>Despite being defined as an asynchronous function, the sum logic is still blocking the time output. You could replace <code>await asyncio.sleep(5)</code> with its synchronous equivalent, <code>time.sleep(5)</code>, and you’d get exactly the same result.</p>
</section>
<section id="why-does-async-block" class="level3">
<h3 class="anchored" data-anchor-id="why-does-async-block">Why does async block?</h3>
<p>While surprising, this behavior is intentional. Shiny goes out of its way to ensure that reactive functions are run in a serial fashion, never concurrently–even if they are asynchronous. This means that if you have two (async) reactive effects that both call <code>await asyncio.sleep(1)</code>, the second one will not even begin to start executing until the first one has finished. This is true even if the two reactive effects belong to two different Shiny sessions and one Python process is serving those sessions.</p>
<p>This may seem like a strange decision on the part of Shiny: why support async at all if the code is not going to run concurrently?</p>
<p>The reason for supporting async is simple: there are functions you may need to call from reactive contexts that are only available as async functions. This includes some functions in Shiny itself that are used to communicate with the browser, like <a href="https://shiny.posit.co/py/docs/api/Session.html#shiny.Session.send_custom_message"><code>Session.send_custom_message</code></a>.</p>
<p>The reason for not allowing (reactive) async code to run concurrently is more nuanced. The main reason is that it would be very difficult to ensure that the application behaves predictably if async code were allowed to run concurrently. Concurrent code works best when tasks are largely independent of each other, and do not read or modify the same shared state. But Shiny reactive code is all about shared state and interconnected tasks.</p>
<p>So in summary, use async functions in your reactive code if you need to call async-only functions. Don’t expect your application to run faster, more responsively, or more efficiently.</p>
</section>
</section>
<section id="true-non-blocking-behavior-with-extendedtask" class="level2">
<h2 class="anchored" data-anchor-id="true-non-blocking-behavior-with-extendedtask">True non-blocking behavior with <code>ExtendedTask</code></h2>
<p>To achieve true non-blocking behavior in Shiny applications, and retain the ability to reason about how our apps will behave, we use the following strategy:</p>
<ol type="1">
<li>Read whatever reactive inputs and calcs will be needed to perform the task.</li>
<li>Perform the task asynchronously and concurrently, outside of the reactive graph.</li>
<li>When the task completes, bring the resulting value (or error, if the operation failed) back into the reactive graph.</li>
</ol>
<p>We’ve created a high-level class called <code>ExtendedTask</code> to make all of this pretty easy. To create an <code>ExtendedTask</code>, use the <code>@reactive.extended_task</code> decorator on an async function. Let’s adapt the example above to use an <code>ExtendedTask</code>:</p>
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
import asyncio
import datetime
from shiny import App, reactive, render, ui

app_ui = ui.page_fluid(
    ui.p("The time is ", ui.output_text("current_time", inline=True)),
    ui.hr(),
    ui.input_numeric("x", "x", value=1),
    ui.input_numeric("y", "y", value=2),
    ui.input_task_button("btn", "Add numbers"),
    ui.output_text("sum"),
)

def server(input, output, session):
    @render.text
    def current_time():
        reactive.invalidate_later(1)
        return datetime.datetime.now().strftime("%H:%M:%S %p")

    @ui.bind_task_button(button_id="btn")
    @reactive.extended_task
    async def sum_values(x, y):
        await asyncio.sleep(5)
        return x + y

    @reactive.effect
    @reactive.event(input.btn)
    def btn_click():
        sum_values(input.x(), input.y())

    @render.text
    def sum():
        return str(sum_values.result())

app = App(app_ui, server)</code></pre>
<p>Note the <code>sum_values</code> function, which is where the actual (slow) work is done. It is decorated with <code>@reactive.extended_task</code>, which means that it will be run asynchronously and concurrently with other tasks, and that its result will be available as <code>sum_values.result()</code>.</p>
<p>We’ve also added a <code>@ui.bind_task_button</code> decorator on top of the <code>@reactive.extended_task</code> decorator.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This synchronizes the <code>ExtendedTask</code> object with the <code>ui.input_task_button</code> in the UI, so that the button will be in its “Processing…” state while the task is running. It <em>does not</em> cause button clicks to invoke the task; we still need to do that manually, which we’ll talk about next.</p>
<p>If you use some other UI gesture or condition besides <code>ui.input_task_button</code> to invoke the task, don’t include the <code>@ui.bind_task_button</code> decorator–it doesn’t work with <code>ui.input_action_button</code>, for example.</p>
</div>
</div>
<section id="invoking-the-task" class="level3">
<h3 class="anchored" data-anchor-id="invoking-the-task">Invoking the task</h3>
<p>Unlike a reactive effect, simply creating an extended task does not cause it to run. It needs to be invoked (called like a function).</p>
<p>In this case, the <code>sum_values</code> extended task is called from the <code>btn_click</code> reactive effect (<code>@reactive.effect</code>), which runs whenever the button is clicked (<code>@reactive.event(input.btn)</code>).</p>
<p>Notice also that the <code>sum_values</code> logic no longer reads <code>input.x()</code> and <code>input.y()</code> directly in the function body. Because it is now an extended task, attempting to do so would result in an error. Instead, it takes <code>x</code> and <code>y</code> as arguments, which are passed in by <code>btn_click</code> based on reactive inputs.</p>
</section>
<section id="retrieving-results" class="level3">
<h3 class="anchored" data-anchor-id="retrieving-results">Retrieving results</h3>
<p>The <code>sum</code> output is now a regular reactive calc, which reads <code>sum_values.result()</code> to get the result of the extended task. This output actually does not “wait for” the extended task to complete, exactly; instead, it will run multiple times, as the extended task goes through different states. For each state, <code>sum_values.result()</code> will behave differently:</p>
<ul>
<li><strong>Not yet invoked:</strong> Raises a silent exception, which will cause the <code>sum</code> output to display nothing.</li>
<li><strong>Running:</strong> Raises a special type of exception that tells Shiny to keep the output in the “in progress” state.</li>
<li><strong>Successfully completed:</strong> Returns the return value of <code>sum_values</code>, in this case an integer.</li>
<li><strong>Completed with an exception:</strong> If <code>sum_values</code> raised an exception while processing, then re-raises that same exception, causing it to be displayed to the user in the <code>sum</code> output.</li>
</ul>
<p>It’s not necessary to memorize these states. Just remember that <code>sum_values.result()</code> is a reactive, synchronous method that knows how to do right thing based on the state of the extended task.</p>
</section>
<section id="other-features-of-extended-tasks" class="level3">
<h3 class="anchored" data-anchor-id="other-features-of-extended-tasks">Other features of extended tasks</h3>
<section id="cancel-a-running-task" class="level4">
<h4 class="anchored" data-anchor-id="cancel-a-running-task">Cancel a running task</h4>
<p>Although it’s not shown in the example above, you can also cancel an extended task by calling the <code>cancel()</code> method (for example, <code>sum_values.cancel()</code>). This will attempt to cancel the asyncio task that is running the extended task, and will cause <code>sum_values.result()</code> to raise a silent exception.</p>
<p>Calling <code>sum_values.cancel()</code> on a task that isn’t running will have no effect.</p>
</section>
<section id="multiple-invocations" class="level4">
<h4 class="anchored" data-anchor-id="multiple-invocations">Multiple invocations</h4>
<p>An extended task can run concurrently to reactive code and to other extended tasks–that’s its whole purpose. However, a single extended task object cannot run itself multiple times concurrently. If you call <code>sum_values()</code> while it is already running, it will enqueue the new invocation and run it after the first one completes.</p>
<p>This is often not the behavior you want, especially if the task takes a long time to complete. A user may accidentally click an action button twice, or they may click it again because they think the first click didn’t work. To prevent this, use <code>ui.input_task_button</code> instead of <code>ui.input_action_button</code> to invoke the task, since the former automatically prevents subsequent clicks until the task completes.</p>
</section>
</section>
<section id="executing-on-a-different-threadprocess" class="level3">
<h3 class="anchored" data-anchor-id="executing-on-a-different-threadprocess">Executing on a different thread/process</h3>
<p>Extended task objects run their tasks using <a href="https://docs.python.org/3/library/asyncio-task.html#asyncio.create_task"><code>asyncio.create_task</code></a>, which means that they will run on the same thread as the rest of the application. This is fine for logic that is truly asynchronous, like making a network request via an asyncio-aware library like <a href="https://docs.aiohttp.org/en/stable/">aiohttp</a>, but it’s not ideal for CPU-bound tasks or when performing I/O synchronously. Because CPU-bound or synchronous tasks will block the main thread, we’re back to where we started: the rest of the application cannot proceed until the task completes.</p>
<p>Fortunately, we can rely on Python’s built-in support for running asyncio tasks on different threads or processes.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The examples below work well in Shiny Core, but a naive port to Shiny Express will not work as well. The <code>ThreadPoolExecutor</code> and <code>ProcessPoolExecutor</code> objects need to be created as module-level variables, not as session-level variables, since we’d ideally like to pool resources across all sessions.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>ProcessPoolExecutor</code> is not available in Shinylive (e.g.&nbsp;WASM mode). <code>ThreadPoolExecutor</code> is available in Shinylive and appears to work, but doesn’t: it actually performs all of its work on the main thread.</p>
</div>
</div>
<p>The following example shows how to run a task on a different thread. This is a good strategy for code that does synchronous I/O, like reading from disk, a database, or a remote API endpoint. It’s not as good of a strategy for CPU-bound code, because Python’s <a href="https://realpython.com/python-gil/">global interpreter lock</a> will prevent the task from running concurrently with other Python code.</p>
<div id="2f5d4808" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="nonblocking.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb3-2"><a href="nonblocking.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> concurrent.futures</span>
<span id="cb3-3"><a href="nonblocking.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb3-4"><a href="nonblocking.html#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="nonblocking.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> App, reactive, render, ui</span>
<span id="cb3-6"><a href="nonblocking.html#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="nonblocking.html#cb3-7" aria-hidden="true" tabindex="-1"></a>app_ui <span class="op">=</span> ui.page_fluid(</span>
<span id="cb3-8"><a href="nonblocking.html#cb3-8" aria-hidden="true" tabindex="-1"></a>    ui.input_numeric(<span class="st">"x"</span>, <span class="st">"x"</span>, value<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb3-9"><a href="nonblocking.html#cb3-9" aria-hidden="true" tabindex="-1"></a>    ui.input_numeric(<span class="st">"y"</span>, <span class="st">"y"</span>, value<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb3-10"><a href="nonblocking.html#cb3-10" aria-hidden="true" tabindex="-1"></a>    ui.input_task_button(<span class="st">"btn"</span>, <span class="st">"Add numbers"</span>),</span>
<span id="cb3-11"><a href="nonblocking.html#cb3-11" aria-hidden="true" tabindex="-1"></a>    ui.output_text(<span class="st">"sum"</span>),</span>
<span id="cb3-12"><a href="nonblocking.html#cb3-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-13"><a href="nonblocking.html#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="nonblocking.html#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute the extended task logic on a different thread. To use a different</span></span>
<span id="cb3-15"><a href="nonblocking.html#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># process instead, use concurrent.futures.ProcessPoolExecutor.</span></span>
<span id="cb3-16"><a href="nonblocking.html#cb3-16" aria-hidden="true" tabindex="-1"></a>pool <span class="op">=</span> concurrent.futures.ThreadPoolExecutor()</span>
<span id="cb3-17"><a href="nonblocking.html#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="nonblocking.html#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> slow_sum(x, y):</span>
<span id="cb3-19"><a href="nonblocking.html#cb3-19" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">5</span>)  <span class="co"># Simulate a slow synchronous task</span></span>
<span id="cb3-20"><a href="nonblocking.html#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y</span>
<span id="cb3-21"><a href="nonblocking.html#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="nonblocking.html#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> server(<span class="bu">input</span>, output, session):</span>
<span id="cb3-23"><a href="nonblocking.html#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ui.bind_task_button</span>(button_id<span class="op">=</span><span class="st">"btn"</span>)</span>
<span id="cb3-24"><a href="nonblocking.html#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">@reactive.extended_task</span></span>
<span id="cb3-25"><a href="nonblocking.html#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> sum_values(x, y):</span>
<span id="cb3-26"><a href="nonblocking.html#cb3-26" aria-hidden="true" tabindex="-1"></a>        loop <span class="op">=</span> asyncio.get_event_loop()</span>
<span id="cb3-27"><a href="nonblocking.html#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cf">await</span> loop.run_in_executor(pool, slow_sum, x, y)</span>
<span id="cb3-28"><a href="nonblocking.html#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="nonblocking.html#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">@reactive.effect</span></span>
<span id="cb3-30"><a href="nonblocking.html#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">@reactive.event</span>(<span class="bu">input</span>.btn)</span>
<span id="cb3-31"><a href="nonblocking.html#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> btn_click():</span>
<span id="cb3-32"><a href="nonblocking.html#cb3-32" aria-hidden="true" tabindex="-1"></a>        sum_values(<span class="bu">input</span>.x(), <span class="bu">input</span>.y())</span>
<span id="cb3-33"><a href="nonblocking.html#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="nonblocking.html#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">@render.text</span></span>
<span id="cb3-35"><a href="nonblocking.html#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">sum</span>():</span>
<span id="cb3-36"><a href="nonblocking.html#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(sum_values.result())</span>
<span id="cb3-37"><a href="nonblocking.html#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="nonblocking.html#cb3-38" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> App(app_ui, server)</span>
<span id="cb3-39"><a href="nonblocking.html#cb3-39" aria-hidden="true" tabindex="-1"></a>app.on_shutdown(pool.shutdown)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With a small tweak, we can run the task on a different process instead of a different thread: just replace <code>concurrent.futures.ThreadPoolExecutor</code> with <code>concurrent.futures.ProcessPoolExecutor</code>. This is a good strategy for CPU-bound code, because it allows the task to run concurrently with other Python code.</p>
<p>In this example, the <code>slow_sum</code> function is defined at the module level, outside of the Shiny server function. This is critically important for <code>ProcessPoolExecutor</code> to work correctly because of how Python’s <code>multiprocessing</code> module works: only module-level functions can survive the trip to a worker Python subprocess. (It’s less critical for <code>ThreadPoolExecutor</code>, but still a good programming practice to define such logic at the module level when possible.)</p>
<p>There’s also the <code>app.on_shutdown(pool.shutdown)</code> line at the end of each example. This is necessary to ensure that the pool is shut down when the app stops running. In particular, if you’re using <code>ProcessPoolExecutor</code> and neglect to shut down the pool, you can end up with orphaned Python processes hanging around.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Only use async functions in your reactive code if you need to call async-only functions. Don’t expect your application to run faster, more responsively, or more efficiently.</p>
<p>To achieve true non-blocking behavior in Shiny applications, factor your slow/async code into an <code>ExtendedTask</code> callable object, call it from a reactive effect, and read its <code>result()</code> from a render function or reactive calc.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="comp-r-shiny.html" class="pagination-link" aria-label="Shiny for R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Shiny for R</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="routing.html" class="pagination-link" aria-label="Routing">
        <span class="nav-page-text">Routing</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Proudly supported by <a href="https://www.posit.co/" class="no-icon"><img src="../images/posit-logo-black.svg" alt="Posit" width="80" style="padding-left: 3px;vertical-align:text-top;"></a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/posit-dev/py-shiny-site/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/posit-dev/py-shiny-site/edit/main/docs/nonblocking.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://discord.gg/yMGCamUMnS">
      <i class="bi bi-discord" role="img" aria-label="Shiny Discord">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/posit-dev/py-shiny/">
      <i class="bi bi-github" role="img" aria-label="Shiny for Python Github">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/posit_pbc">
      <i class="bi bi-twitter" role="img" aria-label="Posit Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/playlist?list=PL9HYL-VRX0oRbLoj3FyL5zeASU5FMDgVe">
      <i class="bi bi-youtube" role="img" aria-label="Shiny YouTube Playlist">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>