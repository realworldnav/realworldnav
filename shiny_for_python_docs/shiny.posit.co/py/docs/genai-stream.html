<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Streaming – Shiny for Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="genai-tools.html" rel="next">
<link href="genai-chatbots.html" rel="prev">
<link href="../favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-888ef42a095209a13a17dbfda2cb877d.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-06a6b8726800c70458725a52052b40c7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content="..">
<script src="../site_libs/quarto-contrib/shinylive-0.10.4/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="../site_libs/quarto-contrib/shinylive-0.10.4/shinylive/run-python-blocks.js" type="module"></script>
<link href="../site_libs/quarto-contrib/shinylive-0.10.4/shinylive/shinylive.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
  // Redirect URLs like https://shiny.posit.co/py to
  // https://shiny.posit.co/py/ (with trailing slash). This is needed for
  // relative paths to work correctly. Unfortunately, Netlify cannot have a
  // redirect that adds or removes a trailing slash.
  if (
    !window.location.pathname.endsWith(".html") &&
    !window.location.pathname.endsWith("/")
  ) {
    window.location.replace(window.location.href + "/");
  }
</script>

<!-- Google Tag Manager -->
<script>
  // prettier-ignore
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KHBDBW7');
</script>
<!-- End Google Tag Manager -->

<!-- Add rel="noopener noreferrer" to each target="_blank" -->
<script type="text/javascript">
  window.addEventListener("load", () =>
    [...document.querySelectorAll("a[target=_blank]")].forEach((lnk) =>
      lnk.setAttribute("rel", "noopener noreferrer")
    )
  );
</script>
<!-- End Add rel="noopener noreferrer" to each target="_blank" -->

<script type="text/javascript">
  (function () {
    function addShinyliveEditLinks() {
      const codeWithLink = document.querySelectorAll(
        ".sourceCode[data-shinylive]"
      );
      codeWithLink.forEach((el) => {
        el.classList.add("code-with-shinylive-link");
        const url = el.dataset.shinylive;

        // <a class="edit-shinylive-button btn btn-link" href="https://shiny.posit.co/py/docs/&lt;%=&#32;app.shinylive&#32;%&gt;" data-bs-toggle="tooltip" data-bs-title="Edit in Shinylive" data-bs-placement="bottom">
        //  <i class="bi bi-lightning-fill"></i> <span class="visually-hidden">Edit in Shinylive</span>
        // </a>

        const link = document.createElement("a");
        link.classList.add("edit-shinylive-button", "btn", "btn-link");
        link.href = url;
        link.dataset.bsToggle = "tooltip";
        link.dataset.bsTitle = "Edit in Shinylive";
        link.dataset.bsPlacement = "bottom";

        const icon = document.createElement("i");
        icon.classList.add("bi", "bi-lightning-fill");
        link.appendChild(icon);

        const span = document.createElement("span");
        span.classList.add("visually-hidden");
        span.innerText = "Edit in Shinylive";
        link.appendChild(span);

        const btnCopy = el.querySelector(".code-copy-button");
        if (btnCopy) {
          btnCopy.parentElement.appendChild(link);
        } else {
          if (el.matches("pre")) {
            el.appendChild(link);
          } else {
            el.querySelector("pre").appendChild(link);
          }
        }

        if (window.bootstrap?.Tooltip) {
          new bootstrap.Tooltip(link);
        }
        el.removeAttribute("data-shinylive");
      });
    }

    function addWhatsShinyExpressTooltip() {
      const tooltipContents = `<p><strong>Shiny Express</strong> is a new, streamlined way to write a Shiny app.</p>
    <p><strong>Shiny Core</strong> refers to the original, functional Shiny syntax, which is still a great way to write Shiny apps.</p>
    <p class="fw-600" style="font-size:0.85em;"><a href="https://shiny.posit.co/blog/posts/shiny-express/">Read more <i class="bi bi-chevron-right align-text-top"></i></a></p>`;

      const tooltipDisplay = `<i class="bi bi-question-circle-fill d-inline d-sm-none"></i><span class="d-none d-sm-inline">What's this?</span>`;

      document
        .querySelectorAll(".panel-tabset.shiny-mode-tabset")
        .forEach(function (tabset) {
          const trigger = document.createElement("div");
          trigger.classList.add("what-shiny-express", "text-white");
          trigger.tabIndex = 0;
          trigger.innerHTML = tooltipDisplay;
          tabset.appendChild(trigger);

          if (!window.bootstrap?.Popover) {
            return;
          }

          new window.bootstrap.Popover(trigger, {
            html: true,
            title: "Express vs Core",
            content: tooltipContents,
            placement: "auto",
            trigger: "focus",
            container: tabset,
          });
        });
    }

    function handlePanelVariants() {
      document.querySelectorAll(".panel-pills > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-pills");
      });
      document.querySelectorAll(".panel-underline > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-underline");
      });
      document.querySelectorAll(".shiny-mode-tabset > .nav").forEach((x) => {
        x.classList.remove("nav-tabs");
        x.classList.add("nav-underline");
      });
    }

    function onLoad() {
      addShinyliveEditLinks();
      addWhatsShinyExpressTooltip();
      handlePanelVariants();
    }

    document.readyState === "loading"
      ? document.addEventListener("DOMContentLoaded", onLoad)
      : onLoad();
  })();
</script>

<!-- <div
  class="alert alert-primary text-center mb-0 border-0"
  style="padding: 0.6rem"
  role="alert"
>
  <p class="d-md-inline my-0 me-md-4 p-90">
    <strong>🎉 Introducing Shiny Express</strong>
  </p>
  <p class="d-md-inline my-0 p-90 me-md-4">
    A simpler way to write and learn Shiny.
  </p>
  <p class="d-md-inline my-0 p-90 me-md-4">
    <a
      href="https://shiny.posit.co/blog/posts/shiny-express/"
      target="_blank"
      style="color: #00314e"
      >Learn more</a
    >.
  </p>
</div> -->


<meta property="og:title" content="Streaming – Shiny for Python">
<meta property="og:description" content="Build interactive web applications easily with the power of Python’s data and scientific stack.">
<meta property="og:image" content="https://shiny.posit.co/py/images/shiny-for-python.jpg">
<meta property="og:site_name" content="Shiny for Python">
<meta property="og:locale" content="es_ES">
<meta name="twitter:title" content="Shiny for Python">
<meta name="twitter:description" content="Build interactive web applications easily with the power of Python’s data and scientific stack.">
<meta name="twitter:image" content="https://shiny.posit.co/py/images/shiny-for-python.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../shiny-for-python.svg" alt="The logo for Shiny for Python" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Shiny for Python</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../get-started/index.html"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="overview.html" aria-current="page"> 
<span class="menu-text">Concepts</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="genai-stream.html#" id="nav-menu-components" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Components</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-components">    
        <li>
    <a class="dropdown-item" href="../components/index.html"><i class="bi bi-sliders" role="img">
</i> 
 <span class="dropdown-text">Components</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../layouts/index.html"><i class="bi bi-layout-text-window-reverse" role="img">
</i> 
 <span class="dropdown-text">Layouts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../templates/index.html"><i class="bi bi-code-square" role="img">
</i> 
 <span class="dropdown-text">Templates</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../gallery/index.html"> 
<span class="menu-text">Gallery</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://shinylive.io/py/examples/" target="_blank"> 
<span class="menu-text">Playground</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="genai-stream.html#" id="nav-menu-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reference">    
        <li>
    <a class="dropdown-item" href="../api/express/index.html">
 <span class="dropdown-text">Shiny Express</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api/core/index.html">
 <span class="dropdown-text">Shiny Core</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api/testing/index.html">
 <span class="dropdown-text">Testing</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://discord.gg/yMGCamUMnS" title="" class="quarto-navigation-tool px-1" aria-label="Shiny Discord"><i class="bi bi-discord"></i></a>
    <a href="https://github.com/posit-dev/py-shiny/" title="" class="quarto-navigation-tool px-1" aria-label="Shiny for Python Github"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="genai-inspiration.html"><span class="emoji-icon">🤖</span> <strong>Generative AI</strong></a></li><li class="breadcrumb-item"><a href="genai-stream.html">Streaming</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📌</span> <strong>Essentials</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="user-interfaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">User interfaces</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🤖</span> <strong>Generative AI</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-inspiration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Get inspired</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-chatbots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chatbots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-stream.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Streaming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tool calling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-structured-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structured data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="genai-rag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAG</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🎨</span> <strong>User interfaces</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="jupyter-widgets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jupyter Widgets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-dynamic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic UI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">UI as HTML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="ui-customize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Customizing UI</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">⚡</span> <strong>Reactivity</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="reactive-mutable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mutable objects</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📝</span> <strong>Syntax modes</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-vs-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Express vs.&nbsp;Core</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-or-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Choosing a syntax</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-in-depth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Express in depth</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="express-to-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transition to Core</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📦</span> <strong>Modules</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="modules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shiny Modules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="module-communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Module Communication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🧪</span> <strong>Testing</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="unit-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="end-to-end-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End-to-End Testing Your App</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🏗️</span> <strong>Extending</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="custom-component-one-off.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom JavaScript component</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="custom-components-pkg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom components package</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">📊</span> <strong>Comparisons</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="comp-streamlit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Streamlit</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="comp-r-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shiny for R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text"><span class="emoji-icon">🧩</span> <strong>Miscellaneous</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="nonblocking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Non-blocking operations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="routing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Routing</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="genai-stream.html#get-started" id="toc-get-started" class="nav-link active" data-scroll-target="#get-started">Get started</a>
  <ul class="collapse">
  <li><a href="genai-stream.html#choose-a-template" id="toc-choose-a-template" class="nav-link" data-scroll-target="#choose-a-template">Choose a template</a></li>
  <li><a href="genai-stream.html#inspect-the-code" id="toc-inspect-the-code" class="nav-link" data-scroll-target="#inspect-the-code">Inspect the code</a></li>
  <li><a href="genai-stream.html#models-prompts" id="toc-models-prompts" class="nav-link" data-scroll-target="#models-prompts">Models &amp; prompts</a></li>
  </ul></li>
  <li><a href="genai-stream.html#content-apis" id="toc-content-apis" class="nav-link" data-scroll-target="#content-apis">Content APIs</a>
  <ul class="collapse">
  <li><a href="genai-stream.html#starting-content" id="toc-starting-content" class="nav-link" data-scroll-target="#starting-content">Starting content</a></li>
  <li><a href="genai-stream.html#appending-content" id="toc-appending-content" class="nav-link" data-scroll-target="#appending-content">Appending content</a></li>
  <li><a href="genai-stream.html#content-generators" id="toc-content-generators" class="nav-link" data-scroll-target="#content-generators">Content generators</a></li>
  <li><a href="genai-stream.html#content-types" id="toc-content-types" class="nav-link" data-scroll-target="#content-types">Content types</a></li>
  <li><a href="genai-stream.html#interactive-content" id="toc-interactive-content" class="nav-link" data-scroll-target="#interactive-content">Interactive content</a></li>
  </ul></li>
  <li><a href="genai-stream.html#card-layout" id="toc-card-layout" class="nav-link" data-scroll-target="#card-layout">Card layout</a></li>
  <li><a href="genai-stream.html#non-blocking-streams" id="toc-non-blocking-streams" class="nav-link" data-scroll-target="#non-blocking-streams">Non-blocking streams</a></li>
  <li><a href="genai-stream.html#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a>
  <ul class="collapse">
  <li><a href="genai-stream.html#error-handling" id="toc-error-handling" class="nav-link" data-scroll-target="#error-handling">Error handling</a></li>
  <li><a href="genai-stream.html#debugging" id="toc-debugging" class="nav-link" data-scroll-target="#debugging">Debugging</a></li>
  </ul></li>
  <li><a href="genai-stream.html#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next steps</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/posit-dev/py-shiny-site/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/posit-dev/py-shiny-site/edit/main/docs/genai-stream.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KHBDBW7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="genai-inspiration.html"><span class="emoji-icon">🤖</span> <strong>Generative AI</strong></a></li><li class="breadcrumb-item"><a href="genai-stream.html">Streaming</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Streaming</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this article, you’ll learn how to stream markdown/HTML content into your app via <code>MarkdownStream()</code>. This component is general purpose, but it’s particularly useful in a generative AI setting where displaying markdown strings <em>as it’s being generated</em> is a common requirement.</p>
<p>Compared to <a href="genai-chatbots.html">the <code>Chat()</code> component</a>, <code>MarkdownStream()</code>’s API is simpler and focuses solely on a streaming display without the conversational UI elements. The possible experiences you can create around <code>MarkdownStream()</code> are vast, but as we’ll see shortly, a common pattern is populate a LLM prompt template based on user input.</p>
<!-- TODO: rework this to be a quick start that utilizes templates -->
<section id="get-started" class="level2">
<h2 class="anchored" data-anchor-id="get-started">Get started</h2>
<section id="choose-a-template" class="level3">
<h3 class="anchored" data-anchor-id="choose-a-template">Choose a template</h3>
<p>Pick from the following LLM providers below to start your streaming markdown app. Copy &amp; paste the relevant <code>shiny create</code> terminal command to get the relevant source files on your machine.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Ollama</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Anthropic</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">OpenAI</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Google</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Bedrock Anthropic</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">Azure OpenAI</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false">LangChain</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-8" role="tab" aria-controls="tabset-1-8" aria-selected="false">Other</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-9" role="tab" aria-controls="tabset-1-9" aria-selected="false">Help me choose!</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="genai-stream.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> stream-ai-ollama</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="genai-stream.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> stream-ai-anthropic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="genai-stream.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> stream-ai-openai</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="genai-stream.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> stream-ai-gemini</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="genai-stream.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> stream-ai-anthropic-aws</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="genai-stream.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> stream-ai-azure-openai</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="genai-stream.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">shiny</span> create <span class="at">--template</span> stream-ai-langchain</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-8-tab">
<p><code>chatlas</code>’s supports a <a href="https://posit-dev.github.io/chatlas/#model-providers">wide variety</a> of LLM providers including Vertex, Snowflake, Groq, Perplexity, and more. In this case, you can start from any template and swap out the <code>chat_client</code> with the relevant chat constructor (e.g., <code>ChatVertex()</code>).</p>
</div>
<div id="tabset-1-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-9-tab">
<p>If you’re not sure which provider to choose, <code>chatlas</code> provides a <a href="https://posit-dev.github.io/chatlas/#model-choice">great guide</a> to help you decide.</p>
</div>
</div>
</div>
<p>When you run the <code>shiny create</code> command, you’ll be provided some tips on where to go to obtain the necessary API keys (if any) and how to securely get them into your app.</p>
<p>Also, if you’re not ready to sign up for a cloud provider (e.g., Anthropic, OpenAI, etc), you can run models locally (for free!) with the Ollama template. This is a great way to get started and learn about LLMs without any cost, and without sharing your data with a cloud provider.</p>
<p>Once your credentials (if any) are in place, <a href="install-create-run.html#run">run the app</a>. Congrats, you now have a streaming markdown interface powered by an LLM of your choice! 🎉</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-stream-quick-start.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Screenshot of the streaming quick start app after a response has been generated."><img src="../images/genai-stream-quick-start.png" class="rounded shadow mt-3 img-fluid figure-img" alt="Screenshot of the streaming quick start app after a response has been generated."></a></p>
<figcaption>Screenshot of the streaming quick start app after a response has been generated.</figcaption>
</figure>
</div>
</section>
<section id="inspect-the-code" class="level3">
<h3 class="anchored" data-anchor-id="inspect-the-code">Inspect the code</h3>
<p>Go ahead and open the <code>app.py</code> file from your template, you’ll see something roughly like this:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="genai-stream.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatOllama</span>
<span id="cb8-2"><a href="genai-stream.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> reactive</span>
<span id="cb8-3"><a href="genai-stream.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> <span class="bu">input</span>, ui</span>
<span id="cb8-4"><a href="genai-stream.html#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="genai-stream.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Might instead be ChatAnthropic, ChatOpenAI, or some other provider</span></span>
<span id="cb8-6"><a href="genai-stream.html#cb8-6" aria-hidden="true" tabindex="-1"></a>chat_client <span class="op">=</span> ChatOllama(model<span class="op">=</span><span class="st">"llama3.2"</span>)</span>
<span id="cb8-7"><a href="genai-stream.html#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="genai-stream.html#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ui.sidebar():</span>
<span id="cb8-9"><a href="genai-stream.html#cb8-9" aria-hidden="true" tabindex="-1"></a>    ui.input_select(</span>
<span id="cb8-10"><a href="genai-stream.html#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"comic"</span>,</span>
<span id="cb8-11"><a href="genai-stream.html#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Choose a comedian"</span>,</span>
<span id="cb8-12"><a href="genai-stream.html#cb8-12" aria-hidden="true" tabindex="-1"></a>        choices<span class="op">=</span>[<span class="st">"Jerry Seinfeld"</span>, <span class="st">"Ali Wong"</span>, <span class="st">"Mitch Hedberg"</span>],</span>
<span id="cb8-13"><a href="genai-stream.html#cb8-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-14"><a href="genai-stream.html#cb8-14" aria-hidden="true" tabindex="-1"></a>    ui.input_action_button(<span class="st">"go"</span>, <span class="st">"Tell me a joke"</span>, class_<span class="op">=</span><span class="st">"btn-primary"</span>)</span>
<span id="cb8-15"><a href="genai-stream.html#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="genai-stream.html#cb8-16" aria-hidden="true" tabindex="-1"></a>stream <span class="op">=</span> ui.MarkdownStream(<span class="bu">id</span><span class="op">=</span><span class="st">"my_stream"</span>)</span>
<span id="cb8-17"><a href="genai-stream.html#cb8-17" aria-hidden="true" tabindex="-1"></a>stream.ui(</span>
<span id="cb8-18"><a href="genai-stream.html#cb8-18" aria-hidden="true" tabindex="-1"></a>    content<span class="op">=</span><span class="st">"Press the button and I'll tell you a joke."</span>,</span>
<span id="cb8-19"><a href="genai-stream.html#cb8-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-20"><a href="genai-stream.html#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="genai-stream.html#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="at">@reactive.effect</span></span>
<span id="cb8-22"><a href="genai-stream.html#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="at">@reactive.event</span>(<span class="bu">input</span>.go)</span>
<span id="cb8-23"><a href="genai-stream.html#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> do_joke():</span>
<span id="cb8-24"><a href="genai-stream.html#cb8-24" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> <span class="ss">f"Pretend you are </span><span class="sc">{</span><span class="bu">input</span><span class="sc">.</span>comic()<span class="sc">}</span><span class="ss"> and tell me a funny joke."</span></span>
<span id="cb8-25"><a href="genai-stream.html#cb8-25" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="cf">await</span> chat_client.stream_async(prompt)</span>
<span id="cb8-26"><a href="genai-stream.html#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> stream.stream(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="genai-stream.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatOllama</span>
<span id="cb9-2"><a href="genai-stream.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> App, reactive, ui</span>
<span id="cb9-3"><a href="genai-stream.html#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="genai-stream.html#cb9-4" aria-hidden="true" tabindex="-1"></a>app_ui <span class="op">=</span> ui.page_sidebar(</span>
<span id="cb9-5"><a href="genai-stream.html#cb9-5" aria-hidden="true" tabindex="-1"></a>    ui.sidebar(</span>
<span id="cb9-6"><a href="genai-stream.html#cb9-6" aria-hidden="true" tabindex="-1"></a>        ui.input_select(</span>
<span id="cb9-7"><a href="genai-stream.html#cb9-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"comic"</span>,</span>
<span id="cb9-8"><a href="genai-stream.html#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Choose a comedian"</span>,</span>
<span id="cb9-9"><a href="genai-stream.html#cb9-9" aria-hidden="true" tabindex="-1"></a>            choices<span class="op">=</span>[<span class="st">"Jerry Seinfeld"</span>, <span class="st">"Ali Wong"</span>, <span class="st">"Mitch Hedberg"</span>],</span>
<span id="cb9-10"><a href="genai-stream.html#cb9-10" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb9-11"><a href="genai-stream.html#cb9-11" aria-hidden="true" tabindex="-1"></a>        ui.input_action_button(<span class="st">"go"</span>, <span class="st">"Tell me a joke"</span>),</span>
<span id="cb9-12"><a href="genai-stream.html#cb9-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-13"><a href="genai-stream.html#cb9-13" aria-hidden="true" tabindex="-1"></a>    ui.output_markdown_stream(<span class="st">"my_stream"</span>),</span>
<span id="cb9-14"><a href="genai-stream.html#cb9-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-15"><a href="genai-stream.html#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="genai-stream.html#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> server(<span class="bu">input</span>):</span>
<span id="cb9-17"><a href="genai-stream.html#cb9-17" aria-hidden="true" tabindex="-1"></a>    stream <span class="op">=</span> ui.MarkdownStream(<span class="bu">id</span><span class="op">=</span><span class="st">"my_stream"</span>)</span>
<span id="cb9-18"><a href="genai-stream.html#cb9-18" aria-hidden="true" tabindex="-1"></a>    chat_client <span class="op">=</span> ChatOllama(model<span class="op">=</span><span class="st">"llama3.2"</span>)</span>
<span id="cb9-19"><a href="genai-stream.html#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="genai-stream.html#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">@reactive.effect</span></span>
<span id="cb9-21"><a href="genai-stream.html#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">@reactive.event</span>(<span class="bu">input</span>.go)</span>
<span id="cb9-22"><a href="genai-stream.html#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> do_joke():</span>
<span id="cb9-23"><a href="genai-stream.html#cb9-23" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="ss">f"Pretend you are </span><span class="sc">{</span><span class="bu">input</span><span class="sc">.</span>comic()<span class="sc">}</span><span class="ss"> and tell me a funny joke."</span></span>
<span id="cb9-24"><a href="genai-stream.html#cb9-24" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> <span class="cf">await</span> chat_client.stream_async(prompt)</span>
<span id="cb9-25"><a href="genai-stream.html#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> stream.stream(response)</span>
<span id="cb9-26"><a href="genai-stream.html#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="genai-stream.html#cb9-27" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> App(app_ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>From here, we can see the key requirements for streaming from an LLM:</p>
<ol type="1">
<li>Initialize a <code>chat_client</code> (e.g., <code>ChatOllama()</code>) to interact with the LLM.
<ul>
<li><a href="https://posit-dev.github.io/chatlas/"><code>chatlas</code></a> isn’t required for this, but it’s highly recommended.</li>
</ul></li>
<li>Initialize a <code>MarkdownStream()</code> component.</li>
<li>Display it’s UI element with <code>stream.ui()</code>.
<ul>
<li>Here you can specify initial content, sizing, and more.</li>
</ul></li>
<li>Define the action which triggers the LLM to generate content.
<ul>
<li>In this case, it’s a button click that prompts the LLM to generate a joke.</li>
<li>Here, <code>chat_client</code> generates a <code>response</code> stream, which is passed along to the <code>.stream()</code> method for display.</li>
</ul></li>
</ol>
<p>In this article, our primary focus is the UI portion of the markdown stream (i.e., <code>stream</code>). That said, since LLM model choice and prompt design are so important for generating good responses, we’ll briefly touch on that first.</p>
</section>
<section id="models-prompts" class="level3">
<h3 class="anchored" data-anchor-id="models-prompts">Models &amp; prompts</h3>
<p>With <code>chatlas</code>, it’s very easy to switch between the model and system prompt behind your <code>chat_client</code>. Just change the <code>model</code> and <code>system_prompt</code> parameters:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="genai-stream.html#cb10-1" aria-hidden="true" tabindex="-1"></a>chat_client <span class="op">=</span> ChatOllama(</span>
<span id="cb10-2"><a href="genai-stream.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  model<span class="op">=</span><span class="st">"llama3.2"</span>,</span>
<span id="cb10-3"><a href="genai-stream.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  system_prompt<span class="op">=</span><span class="st">"You are a helpful assistant"</span>,</span>
<span id="cb10-4"><a href="genai-stream.html#cb10-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you’re new to programming with LLMs, we <strong>highly recommend</strong> visiting the <code>chatlas</code> website for guidance on <a href="https://posit-dev.github.io/chatlas/get-started.html">where to start</a>, <a href="https://posit-dev.github.io/chatlas/#model-choice">choosing a model</a>, and <a href="https://posit-dev.github.io/chatlas/prompt-design.html">designing an effective system prompt</a>.</p>
<p>If you’re not yet ready learn about LLMs, that’s okay! We can still dive into <code>stream</code> UI features without knowing much about LLMs.</p>
</section>
</section>
<section id="content-apis" class="level2">
<h2 class="anchored" data-anchor-id="content-apis">Content APIs</h2>
<section id="starting-content" class="level3">
<h3 class="anchored" data-anchor-id="starting-content">Starting content</h3>
<p>Show content to the user when the <code>MarkdownStream()</code> UI is first displayed by providing a string to the <code>content</code> parameter in <code>stream.ui()</code>.</p>
<p>This is typically most useful for providing a welcome message or instructions to the user.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="genai-stream.html#cb11-1" aria-hidden="true" tabindex="-1"></a>stream.ui(</span>
<span id="cb11-2"><a href="genai-stream.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  content<span class="op">=</span><span class="st">"Press the button and I'll tell you a joke."</span></span>
<span id="cb11-3"><a href="genai-stream.html#cb11-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="genai-stream.html#cb12-1" aria-hidden="true" tabindex="-1"></a>ui.output_markdown_stream(</span>
<span id="cb12-2"><a href="genai-stream.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  content<span class="op">=</span><span class="st">"Press the button and I'll tell you a joke."</span></span>
<span id="cb12-3"><a href="genai-stream.html#cb12-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-stream-starting-content.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Screenshot of a starting content message."><img src="../images/genai-stream-starting-content.png" class="rounded shadow d-block m-auto img-fluid figure-img" style="width:67.0%" alt="Screenshot of a starting content message."></a></p>
<figcaption>Screenshot of a starting content message.</figcaption>
</figure>
</div>
</section>
<section id="appending-content" class="level3">
<h3 class="anchored" data-anchor-id="appending-content">Appending content</h3>
<p>When you <code>.stream()</code> content, you have the choice of whether or not to clear the existing content. By default, existing content is cleared, but you can instead append to the existing content by passing <code>clear=False</code> to <code>stream.stream()</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="genai-stream.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> stream.stream(response, clear<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="content-generators" class="level3">
<h3 class="anchored" data-anchor-id="content-generators">Content generators</h3>
<p>In your starter template, the <code>response</code> stream is provided by <a href="https://posit-dev.github.io/chatlas/"><code>chatlas</code></a> via <code>chat_client.stream_async(prompt)</code>. As it turns out, that <code>response</code> object is an <a href="https://stackoverflow.com/q/1756096">generator</a> of markdown strings, and the <code>.stream()</code> method can work with any generator of strings. This is useful to know if you want to:</p>
<ol type="1">
<li>Use another framework for reponse generation (e.g., <a href="https://www.langchain.com/">LangChain</a>).</li>
<li>Transform the stream as it’s being generated (e.g., highlight keywords).</li>
<li>Manually create a generator (to say, show progress on a <a href="nonblocking.html">non-blocking task</a>).</li>
</ol>
<div class="mobile-layout">
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
#| layout: vertical
#| viewerHeight: 150
#| editorHeight: 250
import asyncio

from shiny import reactive
from shiny.express import input, ui

ui.input_action_button("do_stream", "Do stream", class_="btn btn-primary")

stream = ui.MarkdownStream("stream")
stream.ui()

async def simple_generator():
    yield "Hello "
    await asyncio.sleep(1)
    yield "`MarkdownStream()`!"

@reactive.effect
@reactive.event(input.do_stream)
async def _():
    await stream.stream(simple_generator())</code></pre>
</div>
</section>
<section id="content-types" class="level3">
<h3 class="anchored" data-anchor-id="content-types">Content types</h3>
<p><code>MarkdownStream()</code> supports several different content types through the <code>content_type</code> parameter. The default <code>markdown</code> content type is the most broadly useful, since it not only parses and renders markdown strings, but also renders HTML content.</p>
<ul>
<li><code>markdown</code>: render markdown (specifically CommonMark) as HTML.
<ul>
<li>Currently, you can’t customize the markdown renderer. If you need to customize, apply <code>ui.markdown()</code> to the content before streaming.</li>
</ul></li>
<li><code>html</code>: render a string of HTML as HTML.</li>
<li><code>text</code>: render a string of plain text verbatim.</li>
<li><code>semi-markdown</code>: render a string of markdown as HTML, but with HTML tags escaped.</li>
</ul>
</section>
<section id="interactive-content" class="level3">
<h3 class="anchored" data-anchor-id="interactive-content">Interactive content</h3>
<p><a href="genai-chatbots.html#interactive-messages">Similar to <code>Chat()</code></a>, <code>MarkdownStream()</code> supports interactive content, meaning that content can include Shiny UI elements like <a href="../components/index.html#inputs">inputs</a>, <a href="../components/index.html#outputs">outputs</a>, etc. This allows you to collect user input, display rich interactive output (e.g., <a href="jupyter-widgets.html">Jupyter Widgets</a>), or provide additional context (e.g.&nbsp;<a href="../components/display-messages/tooltips/index.html">tooltips</a>) from within the message stream.</p>
<p>For a basic example, here’s a startup message with an input field:</p>
<div class="mobile-layout">
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [editor, viewer]
#| layout: vertical
#| viewerHeight: 300
from shiny.express import ui

with ui.hold() as welcome:
    "**Hello!** What's your name?"
    ui.input_text("name", None, placeholder="Enter name here")

chat = ui.Chat(id="chat")
chat.ui(messages=[welcome])</code></pre>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interactive tool displays
</div>
</div>
<div class="callout-body-container callout-body">
<p>Probably the most interesting way in which interactive messages can be used is from a custom <a href="genai-tools.html">tool call</a> display. For example, you could have a tool that displays a <a href="../components/outputs/data-grid.html">Data Grid</a> or <a href="jupyter-widgets.html">Jupyter Widget</a> (e.g., a <a href="../components/outputs/plot-plotly/index.html">plotly</a> graph).</p>
</div>
</div>
</section>
</section>
<section id="card-layout" class="level2">
<h2 class="anchored" data-anchor-id="card-layout">Card layout</h2>
<p>When embedding a stream within a larger app, it’s often useful to place it within a <code>ui.card()</code>. This provides a clear visual separation between the stream and other content, and allows you to easily add a header, footer, or other elements around the stream.</p>
<p>In this case, it’s also useful to know that a sidebar layout can also placed within a card:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset panel-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Express</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Core</a></li></ul>
<div class="tab-content panel-pills">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="genai-stream.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.express <span class="im">import</span> ui</span>
<span id="cb16-2"><a href="genai-stream.html#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="genai-stream.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the card to fill the page</span></span>
<span id="cb16-4"><a href="genai-stream.html#cb16-4" aria-hidden="true" tabindex="-1"></a>ui.page_opts(</span>
<span id="cb16-5"><a href="genai-stream.html#cb16-5" aria-hidden="true" tabindex="-1"></a>    fillable<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb16-6"><a href="genai-stream.html#cb16-6" aria-hidden="true" tabindex="-1"></a>    fillable_mobile<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb16-7"><a href="genai-stream.html#cb16-7" aria-hidden="true" tabindex="-1"></a>    class_<span class="op">=</span><span class="st">"bg-light-subtle"</span>,</span>
<span id="cb16-8"><a href="genai-stream.html#cb16-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-9"><a href="genai-stream.html#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="genai-stream.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and display a MarkdownStream()</span></span>
<span id="cb16-11"><a href="genai-stream.html#cb16-11" aria-hidden="true" tabindex="-1"></a>stream <span class="op">=</span> ui.MarkdownStream(<span class="bu">id</span><span class="op">=</span><span class="st">"my_stream"</span>)</span>
<span id="cb16-12"><a href="genai-stream.html#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="genai-stream.html#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ui.card():</span>
<span id="cb16-14"><a href="genai-stream.html#cb16-14" aria-hidden="true" tabindex="-1"></a>    ui.card_header(<span class="st">"Streaming Joke Generator"</span>)</span>
<span id="cb16-15"><a href="genai-stream.html#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="genai-stream.html#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Put sidebar layout in the card</span></span>
<span id="cb16-17"><a href="genai-stream.html#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> ui.layout_sidebar():</span>
<span id="cb16-18"><a href="genai-stream.html#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> ui.sidebar():</span>
<span id="cb16-19"><a href="genai-stream.html#cb16-19" aria-hidden="true" tabindex="-1"></a>            ui.input_select(</span>
<span id="cb16-20"><a href="genai-stream.html#cb16-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">"comic"</span>,</span>
<span id="cb16-21"><a href="genai-stream.html#cb16-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Choose a comedian"</span>,</span>
<span id="cb16-22"><a href="genai-stream.html#cb16-22" aria-hidden="true" tabindex="-1"></a>                choices<span class="op">=</span>[<span class="st">"Jerry Seinfeld"</span>, <span class="st">"Ali Wong"</span>, <span class="st">"Mitch Hedberg"</span>],</span>
<span id="cb16-23"><a href="genai-stream.html#cb16-23" aria-hidden="true" tabindex="-1"></a>                width<span class="op">=</span><span class="st">"auto"</span>,</span>
<span id="cb16-24"><a href="genai-stream.html#cb16-24" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb16-25"><a href="genai-stream.html#cb16-25" aria-hidden="true" tabindex="-1"></a>            ui.input_action_button(<span class="st">"go"</span>, <span class="st">"Tell me a joke"</span>, class_<span class="op">=</span><span class="st">"btn-primary"</span>)</span>
<span id="cb16-26"><a href="genai-stream.html#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="genai-stream.html#cb16-27" aria-hidden="true" tabindex="-1"></a>        stream.ui(content<span class="op">=</span><span class="st">"Press the button and I'll tell you a joke."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="genai-stream.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> ui, App</span>
<span id="cb17-2"><a href="genai-stream.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> faicons <span class="im">import</span> icon_svg</span>
<span id="cb17-3"><a href="genai-stream.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="genai-stream.html#cb17-4" aria-hidden="true" tabindex="-1"></a>app_ui <span class="op">=</span> ui.page_fillable(</span>
<span id="cb17-5"><a href="genai-stream.html#cb17-5" aria-hidden="true" tabindex="-1"></a>    ui.card(</span>
<span id="cb17-6"><a href="genai-stream.html#cb17-6" aria-hidden="true" tabindex="-1"></a>        ui.card_header(<span class="st">"Streaming Joke Generator"</span>),</span>
<span id="cb17-7"><a href="genai-stream.html#cb17-7" aria-hidden="true" tabindex="-1"></a>        ui.layout_sidebar(</span>
<span id="cb17-8"><a href="genai-stream.html#cb17-8" aria-hidden="true" tabindex="-1"></a>            ui.sidebar(</span>
<span id="cb17-9"><a href="genai-stream.html#cb17-9" aria-hidden="true" tabindex="-1"></a>                ui.input_select(</span>
<span id="cb17-10"><a href="genai-stream.html#cb17-10" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"comic"</span>,</span>
<span id="cb17-11"><a href="genai-stream.html#cb17-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Choose a comedian"</span>,</span>
<span id="cb17-12"><a href="genai-stream.html#cb17-12" aria-hidden="true" tabindex="-1"></a>                    choices<span class="op">=</span>[<span class="st">"Jerry Seinfeld"</span>, <span class="st">"Ali Wong"</span>, <span class="st">"Mitch Hedberg"</span>],</span>
<span id="cb17-13"><a href="genai-stream.html#cb17-13" aria-hidden="true" tabindex="-1"></a>                    width<span class="op">=</span><span class="st">"auto"</span>,</span>
<span id="cb17-14"><a href="genai-stream.html#cb17-14" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb17-15"><a href="genai-stream.html#cb17-15" aria-hidden="true" tabindex="-1"></a>                ui.input_action_button(<span class="st">"go"</span>, <span class="st">"Tell me a joke"</span>, class_<span class="op">=</span><span class="st">"btn-primary"</span>),</span>
<span id="cb17-16"><a href="genai-stream.html#cb17-16" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb17-17"><a href="genai-stream.html#cb17-17" aria-hidden="true" tabindex="-1"></a>            ui.output_markdown_stream(<span class="st">"stream"</span>, content<span class="op">=</span><span class="st">"Press the button and I'll tell you a joke."</span>),</span>
<span id="cb17-18"><a href="genai-stream.html#cb17-18" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb17-19"><a href="genai-stream.html#cb17-19" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-20"><a href="genai-stream.html#cb17-20" aria-hidden="true" tabindex="-1"></a>    fillable_mobile<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb17-21"><a href="genai-stream.html#cb17-21" aria-hidden="true" tabindex="-1"></a>    class_<span class="op">=</span><span class="st">"bg-light"</span>,</span>
<span id="cb17-22"><a href="genai-stream.html#cb17-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-23"><a href="genai-stream.html#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="genai-stream.html#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> server(<span class="bu">input</span>):</span>
<span id="cb17-25"><a href="genai-stream.html#cb17-25" aria-hidden="true" tabindex="-1"></a>    stream <span class="op">=</span> ui.MarkdownStream(<span class="bu">id</span><span class="op">=</span><span class="st">"stream"</span>)</span>
<span id="cb17-26"><a href="genai-stream.html#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="genai-stream.html#cb17-27" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> App(app_ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-stream-card-layout.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Screenshot of a stream within a card layout."><img src="../images/genai-stream-card-layout.png" class="rounded shadow img-fluid figure-img" alt="Screenshot of a stream within a card layout."></a></p>
<figcaption>Screenshot of a stream within a card layout.</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Multi-card layout
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want multiple cards in an app, it’s useful to know about Shiny’s <a href="../layouts/arrange/index.html#">grid layout options</a>.</p>
</div>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Auto-scroll
</div>
</div>
<div class="callout-body-container callout-body">
<p>A nice result of placing a stream in a card is that when it overflows the card (either because it has a specified height or because it’s in a fillable page), the card will automatically scroll to show the new content.</p>
<p>This can be disabled by setting <code>auto_scroll=False</code> when creating the UI element.</p>
</div>
</div>
</section>
<section id="non-blocking-streams" class="level2">
<h2 class="anchored" data-anchor-id="non-blocking-streams">Non-blocking streams</h2>
<p><a href="genai-chatbots.html#non-blocking-streams">Similar to <code>Chat()</code></a>’s <code>.append_message_stream()</code>, <code>MarkdownStream()</code>’s <code>.stream()</code> launches a non-blocking <a href="nonblocking.html">extended task</a>. This allows the app to be responsive while the AI generates the response, even when multiple concurrent users are on a single Python process.</p>
<p>A few other benefits of an extended task is that they make it easy to:</p>
<ol type="1">
<li>Reactively read for the <code>.result()</code>.</li>
<li>Reactively read for the <code>.status()</code>.</li>
<li><code>.cancel()</code> the stream.</li>
</ol>
<p>To grab the latest message stream, read the <code>.latest_stream</code> property on the <code>stream</code> object. This property always points to the most recent stream, making it easy to work with it in a reactive context. Here’s an example of reactively reading the status and result of the latest stream:</p>
<div class="mobile-layout">
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
# | standalone: true
# | components: [editor, viewer]
# | layout: vertical
# | viewerHeight: 350
# | editorHeight: 300

## file: app.py
from app_utils import stream_generator
from shiny import reactive
from shiny.express import input, render, ui

stream = ui.MarkdownStream("stream")

ui.input_action_button("start_stream", "Start stream", class_="btn-primary")

@render.code
def stream_status():
    return f"Status: {stream.latest_stream.status()}"


stream.ui(content="Press the button to start streaming.")


@render.text
async def stream_result():
    return f"Result: {stream.latest_stream.result()}"


@reactive.effect
@reactive.event(input.start_stream)
async def _():
    await stream.stream(stream_generator())


## file: app_utils.py
import asyncio


async def stream_generator():
    for i in range(5):
        await asyncio.sleep(0.5)
        yield f"Message {i} \n\n"</code></pre>
</div>
<p>Providing good UI/UX for canceling a stream is a bit more involved, but it can be done with a button that cancels the stream and notifies the user. See the example below for an approach to this:</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stream cancellation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="mobile-layout">
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
# | standalone: true
# | components: [editor, viewer]
# | layout: vertical
# | viewerHeight: 350
# | editorHeight: 300

## file: app.py
from app_utils import stream_generator

from shiny import reactive
from shiny.express import input, ui


with ui.layout_column_wrap():
    ui.input_action_button(
        "do_stream",
        "Start stream",
        class_="btn btn-primary",
    )

    ui.input_action_button(
        "cancel",
        "Cancel stream",
        class_="btn btn-danger",
    )

stream = ui.MarkdownStream("stream")
stream.ui(content="Press the button to start streaming.")


@reactive.effect
@reactive.event(input.do_stream)
async def _():
    await stream.stream(stream_generator())


@reactive.effect
@reactive.event(input.cancel)
def _():
    stream.latest_stream.cancel()
    ui.notification_show("Stream cancelled", type="warning")


@reactive.effect
def _():
    ui.update_action_button(
        "cancel", disabled=stream.latest_stream.status() != "running"
    )


## file: app_utils.py
import asyncio


async def stream_generator():
    for i in range(3):
        await asyncio.sleep(0.75)
        yield f"Message {i} \n\n"</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting">Troubleshooting</h2>
<section id="error-handling" class="level3">
<h3 class="anchored" data-anchor-id="error-handling">Error handling</h3>
<p>Usually, when an error occurs in a <code>reactive.effect</code>, the error crashes the app, forcing the user to refresh the page. This behavior is intentional since, when an error occurs in a <code>reactive.effect</code>, the user isn’t notified of the error, and the app is in an unknown state.</p>
<p>Since LLM response generation can be flaky (e.g., due to rate/context limits, network issues, etc), you may want to handle errors during response more gracefully.</p>
<p>As it turns out, when an error occurs <em>inside</em> a <code>.stream()</code>, the error is caught and re-thrown by a special <code>NotifyException</code> which notifies the user of the error, and allows the app to continue running. When running locally, the actual error message is shown, but in production, only a generic message is shown (i.e., the error is sanitized since it may contain sensitive information).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/genai-stream-errors.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Screenshot of a chatbot with an error message."><img src="../images/genai-stream-errors.png" class="rounded shadow mb-5 d-block m-auto img-fluid figure-img" style="width:67.0%" alt="Screenshot of a chatbot with an error message."></a></p>
<figcaption>Screenshot of a chatbot with an error message.</figcaption>
</figure>
</div>
<p>This is should be good enough to catch most errors that occur during response generation. However, it’s also good to be aware though that other errors that might occur elsewhere in a <code>reactive.effect</code> will still crash the app. If you’d like to protect against this, you can wrap them in a <code>try</code>/<code>except</code> block, and re-raise the error as a <code>NotifyException</code>, like this:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="genai-stream.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny.types <span class="im">import</span> NotifyException</span>
<span id="cb20-2"><a href="genai-stream.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shiny <span class="im">import</span> reactive</span>
<span id="cb20-3"><a href="genai-stream.html#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="genai-stream.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">@reactive.effect</span></span>
<span id="cb20-5"><a href="genai-stream.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">@reactive.event</span>(<span class="bu">input</span>.go)</span>
<span id="cb20-6"><a href="genai-stream.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> do_joke():</span>
<span id="cb20-7"><a href="genai-stream.html#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb20-8"><a href="genai-stream.html#cb20-8" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="ss">f"Pretend you are </span><span class="sc">{</span><span class="bu">input</span><span class="sc">.</span>comic()<span class="sc">}</span><span class="ss"> and tell me a funny joke."</span></span>
<span id="cb20-9"><a href="genai-stream.html#cb20-9" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> <span class="cf">await</span> chat_client.stream_async(prompt)</span>
<span id="cb20-10"><a href="genai-stream.html#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb20-11"><a href="genai-stream.html#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> NotifyException(<span class="ss">f"An error occurred in do_joke: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>) <span class="im">from</span> e</span>
<span id="cb20-12"><a href="genai-stream.html#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> stream.stream(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Customized error handling
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’d like to customize how <code>MarkdownStream()</code> handles errors, you can do so by setting the <code>on_error</code> parameter in the constructor. See <a href="../api/ui.MarkdownStream.html">the documentation</a>.</p>
</div>
</div>
</section>
<section id="debugging" class="level3">
<h3 class="anchored" data-anchor-id="debugging">Debugging</h3>
<p>Sometimes response generation from an LLM might not be quite what you expect, leaving you to wonder what went wrong. With <code>chatlas</code>, your primary interactive debugging tool is to set <code>echo="all"</code> in the <code>.stream_async()</code> method to see the context of the chat history (emitted to your Python console). For lower-level debugging, you can also enable logging and/or access the full chat history via the <code>chat_client.get_turns()</code> method. For more, see <code>chatlas</code>’ <a href="https://posit-dev.github.io/chatlas/#troubleshooting">troubleshooting guide</a>.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Monitoring in production
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since <code>chatlas</code> builds on top of official Python SDKs like <code>openai</code> and <code>anthropic</code>, <a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/monitor-openai">monitoring</a> solutions that integrate with their <a href="https://github.com/openai/openai-python?tab=readme-ov-file#logging">logging</a> mechanism can be used to monitor and debug your chatbot in production.</p>
</div>
</div>
</section>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>The <a href="genai-stream.html">next article</a> covers a very useful technique for both <a href="genai-chatbots.html">chatbots</a> and streaming markdown: <a href="genai-tools.html">tool calling</a>.</p>
<p>Skip to other articles in the series if you want to learn about other generally useful Generative AI techniques like <a href="genai-tools.html">tool calls</a>, <a href="genai-structured-data.html">structured output</a>, and <a href="genai-rag.html">RAG</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="genai-chatbots.html" class="pagination-link" aria-label="Chatbots">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Chatbots</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="genai-tools.html" class="pagination-link" aria-label="Tool calling">
        <span class="nav-page-text">Tool calling</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Proudly supported by <a href="https://www.posit.co/" class="no-icon"><img src="../images/posit-logo-black.svg" alt="Posit" width="80" style="padding-left: 3px;vertical-align:text-top;"></a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/posit-dev/py-shiny-site/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/posit-dev/py-shiny-site/edit/main/docs/genai-stream.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://discord.gg/yMGCamUMnS">
      <i class="bi bi-discord" role="img" aria-label="Shiny Discord">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/posit-dev/py-shiny/">
      <i class="bi bi-github" role="img" aria-label="Shiny for Python Github">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/posit_pbc">
      <i class="bi bi-twitter" role="img" aria-label="Posit Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/playlist?list=PL9HYL-VRX0oRbLoj3FyL5zeASU5FMDgVe">
      <i class="bi bi-youtube" role="img" aria-label="Shiny YouTube Playlist">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"fade","descPosition":"bottom","loop":false,"openEffect":"fade","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>